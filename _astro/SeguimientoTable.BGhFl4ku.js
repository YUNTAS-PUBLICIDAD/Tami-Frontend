import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.DtoOFyvK.js";import{c as A,e as F,f as B,F as P,a as L,d as R}from"./index.BT90q9ig.js";import{g as S,c as T}from"./config.BD8tWXmp.js";import{S as h}from"./sweetalert2.esm.all.DGhwgajj.js";import{P as q}from"./Paginator.D2XLVpCH.js";const O=()=>{const n=()=>{const s=localStorage.getItem("token");if(!s)throw new Error("No se encontró el token");return s};return{addCliente:async s=>{const r=n(),i=S(T.endpoints.clientes.create),a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(s)});if(!a.ok){let f=null;try{f=await a.json()}catch{}throw f?new Error(JSON.stringify(f)):new Error("Error al agregar cliente")}return(await a.json()).data},updateCliente:async(s,r)=>{const i=n(),a=S(T.endpoints.clientes.update(s)),l=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)});if(!l.ok)throw new Error("Error al actualizar cliente");return(await l.json()).data},deleteCliente:async s=>{const r=n(),i=S(T.endpoints.clientes.delete(s)),a=await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Error al eliminar cliente");return await a.json()}}},G=(n,x)=>{const[o,m]=c.useState({name:"",celular:"",email:""}),[s,r]=c.useState({}),[i,a]=c.useState(!1),{addCliente:l,updateCliente:f}=O();c.useEffect(()=>{n?(m({name:n.name,celular:n.celular,email:n.email}),a(!0),r({})):j()},[n]);const b=w=>{m({...o,[w.target.name]:w.target.value}),r({...s,[w.target.name]:""})},y=async w=>{w.preventDefault(),r({});const{name:N,celular:u,email:C}=o;if(!N.trim()||!u.trim()||!C.trim()){await h.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."});return}if(!/^\d+$/.test(u)){await h.fire({icon:"warning",title:"Teléfono inválido",text:"⚠️ El teléfono solo debe contener números."});return}try{i?(await f(n.id,{name:N,celular:u,email:C}),await h.fire({icon:"success",title:"Cliente actualizado",text:"✅ Cliente actualizado correctamente"})):(await l({name:N,celular:u,email:C}),await h.fire({icon:"success",title:"Cliente registrado",text:"✅ Cliente registrado exitosamente"})),x?.(),j()}catch(p){console.error("❌ Error en la operación:",p);let g={};try{const d=JSON.parse(p.message);if(d.errors)d.errors.name&&(g.name=d.errors.name.join(" ")),d.errors.celular&&(g.celular=d.errors.celular.join(" ")),d.errors.email&&(g.email=d.errors.email.join(" "));else if(d.message){await h.fire({icon:"error",title:"Error",text:`❌ ${d.message}`});return}else{await h.fire({icon:"error",title:"Error",text:"❌ Error desconocido."});return}}catch{await h.fire({icon:"error",title:"Error",text:`❌ ${p.message||"Error desconocido"}`});return}r({name:g.name||"",celular:g.celular||"",email:g.email||""})}},j=()=>{m({name:"",celular:"",email:""}),r({}),a(!1)};return{formData:o,errors:s,handleChange:b,handleSubmit:y,resetForm:j}},J=({isOpen:n,setIsOpen:x,cliente:o,onRefetch:m})=>{const{formData:s,handleChange:r,handleSubmit:i,errors:a,resetForm:l}=G(o,()=>{m(),x(!1)});return n?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl px-6 sm:px-8 py-8 sm:py-10 animate-scaleIn",children:[e.jsx("h2",{className:"text-2xl font-bold text-teal-600 mb-6 text-center",children:o?"Editar Cliente":"Añadir Cliente"}),e.jsxs("form",{onSubmit:i,className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",className:"text-sm font-medium text-teal-700 mb-1",children:"Nombres"}),e.jsx("input",{id:"name",name:"name",type:"text",value:s.name,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${a.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. Juan Pérez"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:a.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"celular",className:"text-sm font-medium text-teal-700 mb-1",children:"Teléfono"}),e.jsx("input",{id:"celular",name:"celular",type:"text",value:s.celular,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${a.celular?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. 987654321"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:a.celular||" "})]}),e.jsxs("div",{className:"flex flex-col sm:col-span-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-teal-700 mb-1",children:"Gmail"}),e.jsx("input",{id:"email",name:"email",type:"email",value:s.email,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${a.email?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. cliente@gmail.com"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:a.email||" "})]}),e.jsxs("div",{className:"sm:col-span-2 flex flex-col sm:flex-row justify-end items-center gap-3 mt-4",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto bg-teal-600 text-white px-5 py-2 rounded-lg hover:bg-teal-700 transition shadow",children:o?"Guardar Cambios":"Añadir Cliente"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),l()},className:"w-full sm:w-auto bg-gray-100 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-200 transition",children:"Cancelar"})]})]})]})}):null},U=({isOpen:n,setIsOpen:x,clienteId:o,onRefetch:m})=>{const{deleteCliente:s}=O(),r=async()=>{if((await h.fire({title:"¿Eliminar cliente?",text:"Esta acción es permanente y no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await s(o),h.fire("Eliminado","El cliente ha sido eliminado exitosamente.","success"),m()}catch(a){console.error("Error al eliminar cliente:",a),h.fire("Error","No se pudo eliminar el cliente.","error")}x(!1)};return n&&r(),null},_=n=>{const[x,o]=c.useState([]),[m,s]=c.useState(!0),[r,i]=c.useState(null);return c.useEffect(()=>{(async()=>{s(!0),i(null);try{const l=localStorage.getItem("token");if(!l)throw new Error("No se encontró el token de autenticación");const f=`${S(T.endpoints.clientes.list)}`,b=await fetch(f,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});if(!b.ok)throw new Error(`Error al obtener clientes: ${b.statusText}`);const y=await b.json(),j=Array.isArray(y.data)?y.data:y.data?.data||[];o(j)}catch(l){console.error("Error en fetchClientes:",l),i(l instanceof Error?l.message:"Ocurrió un error desconocido")}finally{s(!1)}})()},[n]),{clientes:x,loading:m,error:r}},Y=()=>{const[n,x]=c.useState(!1),[o,m]=c.useState(1),{clientes:s,loading:r,error:i}=_(n),[a,l]=c.useState(!1),[f,b]=c.useState(null),[y,j]=c.useState(!1),[w,N]=c.useState(null),[u,C]=c.useState("");c.useEffect(()=>{m(1)},[u]);const p=5,g=s.filter(t=>t.name.toLowerCase().includes(u.toLowerCase())||t.email.toLowerCase().includes(u.toLowerCase())||t.celular?.toLowerCase().includes(u.toLowerCase())||t.id.toString().includes(u)),d=g.length,D=Math.ceil(d/p),v=g.slice((o-1)*p,o*p),k=()=>x(t=>!t),I=t=>{b(t),l(!0)},M=()=>{b(null),l(!0)},$=t=>{N(t),j(!0)},z=t=>{x(E=>!E),l(!1),h.fire({icon:"success",title:"Operación exitosa",text:t||"El cliente se ha guardado correctamente",confirmButtonColor:"#14b8a6"})};return r?e.jsx("div",{className:"flex justify-center items-center py-24 bg-white rounded-2xl shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-3 border-b-3 border-teal-500"}),e.jsx("p",{className:"text-teal-600 font-medium text-lg",children:"Cargando clientes..."})]})}):i?e.jsx("div",{className:"text-center py-16 bg-white rounded-2xl shadow-lg",children:e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl max-w-md mx-auto border border-red-100",children:[e.jsx("p",{className:"text-red-600 font-medium mb-4",children:"Error al cargar los clientes:"}),e.jsx("p",{className:"bg-white p-3 rounded-lg text-red-500 mb-6 border border-red-100",children:i}),e.jsxs("button",{onClick:k,className:"px-5 py-2 bg-teal-500 text-white rounded-full hover:bg-teal-600 flex items-center gap-2 mx-auto transition-all duration-300 shadow-md",children:[e.jsx(A,{})," Intentar nuevamente"]})]})}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-teal-600 px-8 py-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-extrabold flex items-center gap-3 text-white",children:[e.jsx(F,{}),e.jsx("span",{children:"Gestión de Clientes"})]}),e.jsx("p",{className:"text-teal-50 mt-2 text-lg",children:"Seguimiento y administración de clientes"})]}),e.jsxs("button",{onClick:M,className:"flex items-center gap-2 bg-white text-teal-600 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold shadow-md hover:shadow-lg",children:[e.jsx(B,{})," Agregar Cliente"]})]})}),e.jsxs("div",{className:"p-8 space-y-6 border-b border-gray-100 bg-white",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(P,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-4 w-4 text-teal-500"}),e.jsx("input",{type:"text",placeholder:"Buscar clientes...",className:"pl-10 w-full rounded-full border-2 border-teal-100 py-3 px-5 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent shadow-sm transition-all duration-300",value:u,onChange:t=>C(t.target.value)})]}),e.jsxs("button",{onClick:k,disabled:r,className:"flex items-center gap-2 bg-white text-teal-600 border-2 border-teal-500 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold w-full sm:w-auto justify-center shadow-sm",children:[e.jsx(A,{className:`h-4 w-4 ${r?"animate-spin":""}`}),r?"Cargando...":"Actualizar"]})]}),e.jsx("div",{className:"flex items-center justify-between bg-teal-50 p-4 rounded-xl border border-teal-100 shadow-sm",children:e.jsxs("div",{className:"text-sm font-medium text-teal-700 flex items-center gap-2",children:[e.jsx("span",{className:"bg-teal-500 text-white text-sm font-bold py-1 px-3 rounded-full",children:d}),d===1?"cliente":"clientes"," encontrados"]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-teal-50 text-teal-800",children:e.jsx("tr",{children:["ID","NOMBRE","EMAIL","TELÉFONO","ACCIÓN"].map((t,E)=>e.jsx("th",{className:"px-6 py-4 text-left font-bold tracking-wide uppercase text-xs whitespace-nowrap",children:t},E))})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-16 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(F,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:u?"No se encontraron clientes que coincidan con tu búsqueda":"No hay clientes registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:u?"Intenta con otros términos de búsqueda":"Comienza agregando clientes a tu sistema con el botón 'Agregar Cliente'"})]})})}):e.jsxs(e.Fragment,{children:[v.map(t=>e.jsxs("tr",{className:"hover:bg-teal-50/50 transition-colors duration-200 h-17",children:[e.jsxs("td",{className:"px-6 py-4 font-medium whitespace-nowrap text-teal-700",children:["#",t.id]}),e.jsx("td",{className:"px-6 py-4 font-medium",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-blue-600",children:t.email}),e.jsx("td",{className:"px-6 py-4",children:t.celular||e.jsx("span",{className:"text-gray-400 italic text-xs",children:"No disponible"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-green-100 text-green-600 transition-colors duration-200 border border-transparent hover:border-green-200",title:"Editar",onClick:()=>I(t),children:e.jsx(L,{size:18})}),e.jsx("button",{className:"p-2 rounded-full text-red-500 border border-transparent transition-colors duration-200 hover:bg-red-100 hover:border-red-200",title:"Eliminar",onClick:()=>$(t.id),children:e.jsx(R,{size:18})})]})})]},t.id)),Array.from({length:p-v.length}).map((t,E)=>e.jsxs("tr",{className:"h-17",children:[" ",e.jsx("td",{colSpan:5,className:"px-6 py-4",children:" "})]},`empty-${E}`))]})})]})}),v.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 px-6 py-4 bg-gray-50 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(o-1)*p+1," -"," ",Math.min(o*p,d)," de ",d," clientes"]}),e.jsx(q,{currentPage:o,totalPages:D,onPageChange:t=>m(t)})]})]}),e.jsx(J,{isOpen:a,setIsOpen:l,cliente:f,onRefetch:z}),w!==null&&e.jsx(U,{isOpen:y,setIsOpen:j,clienteId:w,onRefetch:k})]})};export{Y as default};
