import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{c as k,g as E}from"./config.BBxWIZNq.js";import{R as C,r}from"./index.Be8AcK8B.js";const j="productos_cache",I=300*1e3,_=()=>{try{const a=localStorage.getItem(j);if(!a)return null;const{data:t,timestamp:o}=JSON.parse(a);return Date.now()-o>I?(localStorage.removeItem(j),null):t}catch{return null}},R=a=>{try{const t={data:a,timestamp:Date.now()};localStorage.setItem(j,JSON.stringify(t))}catch{}},M=k.apiUrl;function W(){const[a,t]=r.useState([]),[o,n]=r.useState(!0),[c,u]=r.useState(null),[l,m]=r.useState(!1),i=r.useRef(null),g=r.useCallback(async(x=!0)=>{try{if(i.current&&i.current.abort(),n(!0),u(null),m(!0),x){const s=_();if(s){const h=p(s);t(h.map((d,S)=>e.jsx(N,{...d},`${d.nombreSeccion}-${S}`))),n(!1),m(!1);return}}i.current=new AbortController;const f=await fetch(E(k.endpoints.productos.list),{signal:i.current.signal});if(!f.ok)throw new Error("Error al obtener productos");const y=(await f.json()).map(s=>{let h=[];return Array.isArray(s.imagenes)&&(h=s.imagenes.map(d=>({url_imagen:d.url_imagen||d.url||"",texto_alt_SEO:d.texto_alt_SEO||d.alt||"",imageTitle:d.imageTitle||""}))),{id:s.id,nombre:s.nombre,link:s.link,titulo:s.titulo,subtitulo:s.subtitulo,lema:s.lema,descripcion:s.descripcion,especificaciones:s.especificaciones||{},productos_relacionados:s.productos_relacionados||[],imagenes:h,stock:s.stock,precio:parseFloat(s.precio),seccion:s.seccion,createdAt:s.created_at}});R(y);const L=p(y);t(L.map((s,h)=>e.jsx(N,{...s},`${s.nombreSeccion}-${h}`)))}catch(f){if(f.name==="AbortError")return;console.error("Error cargando productos:",f),u("Error al cargar los productos. Por favor, intenta nuevamente.")}finally{n(!1),m(!1)}},[]),p=r.useMemo(()=>x=>["Negocio","Decoración","Maquinaria"].map(b=>({nombreSeccion:b,productosDeLaSeccion:x.filter(v=>v.seccion===b)})),[]),w=r.useCallback(()=>{l||g(!1)},[g,l]);return r.useEffect(()=>(g(),()=>{i.current&&i.current.abort()}),[g]),o?e.jsx(A,{}):c?e.jsx("section",{className:"w-full flex flex-col items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:c}),e.jsx("button",{onClick:w,disabled:l,className:`px-6 py-2 rounded-lg transition-colors ${l?"bg-gray-400 cursor-not-allowed":"bg-teal-600 hover:bg-teal-700 text-white"}`,children:l?"Cargando...":"Reintentar"})]})}):e.jsx("section",{className:"w-full grid grid-rows-auto",children:a})}function A(){return e.jsx("section",{className:"w-full grid grid-rows-auto",children:[1,2,3].map(a=>e.jsx("div",{className:"flex justify-center relative py-6 sm:py-8 md:py-10",children:e.jsxs("div",{className:"relative w-[95%] xs:w-[90%] sm:w-4/5 place-self-center",children:[e.jsx("div",{className:"bg-gray-300 animate-pulse h-10 w-48 mb-6 rounded"}),e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 xs:gap-4 sm:gap-6 md:gap-8 mt-4 sm:mt-6",children:[1,2,3,4,5,6,7,8].map(t=>e.jsxs("div",{className:"my-4 sm:my-6 md:my-10 flex flex-col items-center",children:[e.jsx("div",{className:"bg-gray-300 animate-pulse rounded-[15%] w-4/5 h-4/5 md:h-56 md:w-56 mb-3"}),e.jsx("div",{className:"bg-gray-300 animate-pulse h-4 w-3/4 rounded"})]},t))})]})},a))})}const $=C.memo(function({nombreSeccion:t,productosDeLaSeccion:o}){const n=r.useMemo(()=>o.length===0?e.jsx("p",{className:"text-gray-400 text-lg col-span-full text-center py-8",children:"No hay productos en esta sección."}):o.map(c=>e.jsx(P,{producto:c},c.id)),[o]);return e.jsx("div",{className:"flex justify-center relative py-6 sm:py-8 md:py-10",id:t,children:e.jsxs("div",{className:"relative w-[95%] xs:w-[90%] sm:w-4/5 place-self-center",children:[e.jsx("h2",{className:`text-white bg-gradient-to-r from-teal-900 via-teal-700 py-2 sm:py-3
                       w-fit text-xl xs:text-2xl sm:text-3xl font-bold
                       ps-3 xs:ps-4 sm:ps-5 lg:ps-10
                       pe-8 xs:pe-12 sm:pe-16 lg:pe-28`,children:t}),e.jsx("div",{className:`grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4
                       gap-2 xs:gap-4 sm:gap-6 md:gap-8
                       mt-4 sm:mt-6`,children:n})]})})}),N=$;function D(a={}){const[t,o]=r.useState(!1),[n,c]=r.useState(!1),u=r.useRef(null);return r.useEffect(()=>{const l=u.current;if(!l)return;const m=new IntersectionObserver(([i])=>{o(i.isIntersecting),i.isIntersecting&&!n&&c(!0)},{threshold:.1,rootMargin:"100px",...a});return m.observe(l),()=>{m.unobserve(l)}},[n,a]),{targetRef:u,isIntersecting:t,hasIntersected:n}}const O=C.memo(function({producto:t}){const[o,n]=r.useState(!1),[c,u]=r.useState(!1),{targetRef:l,hasIntersected:m}=D(),i=r.useMemo(()=>{if(t.imagenes&&t.imagenes.length>0&&t.imagenes[0].url_imagen){const x=t.imagenes[0].url_imagen;return x.startsWith("http")?x:`${M.replace(/\/$/,"")}${x}`}return`https://placehold.co/300x300/e5e7eb/6b7280?text=${encodeURIComponent(t.nombre)}`},[t.imagenes,t.nombre]),g=r.useMemo(()=>({alt:t.imagenes[0]?.texto_alt_SEO||t.nombre,title:t.imagenes[0]?.texto_alt_SEO||t.imagenes[0]?.imageTitle}),[t.imagenes,t.nombre]),p=r.useCallback(()=>n(!0),[]),w=r.useCallback(()=>{u(!0),n(!0)},[]);return e.jsxs("a",{href:`/productos/${t.link}`,title:`Ver detalles de ${t.nombre}`,className:"my-4 sm:my-6 md:my-10 flex flex-col items-center group hover:cursor-pointer w-full",children:[e.jsxs("div",{ref:l,className:"bg-gray-300 rounded-[15%] place-self-center w-4/5 h-4/5 md:h-56 md:w-56 md:p-0 mb-3 overflow-hidden shadow-md group-hover:shadow-xl transition-shadow duration-300 relative",children:[!o&&!c&&e.jsx("div",{className:"absolute inset-0 bg-gray-300 animate-pulse flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})})}),m&&e.jsx("img",{src:i,alt:g.alt,title:g.title,loading:"lazy",onLoad:p,onError:w,className:`h-full w-full object-cover transition-all duration-500 ease-out group-hover:scale-110 ${o?"opacity-100":"opacity-0"}`,style:{aspectRatio:"1"}})]}),e.jsxs("div",{className:"flex flex-row justify-center items-center text-teal-700 mt-3",children:[e.jsxs("svg",{viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"group-hover:scale-75 transition-transform duration-300 ease-in-out w-[40px] h-[40px] md:w-[50px] md:h-[50px]",children:[e.jsx("path",{d:"M16 4L8 12L16 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(-2, 0)"}),e.jsx("path",{d:"M16 4L8 12L16 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(5, 0)"})]}),e.jsx("div",{className:"flex-grow text-center group w-full px-2",children:e.jsx("h3",{className:"text-base sm:text-lg font-bold text-teal-700 leading-snug break-words whitespace-normal group-hover:scale-105 transition-transform duration-300 ease-in-out",children:t.nombre})}),e.jsxs("svg",{viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"group-hover:scale-75 transition-transform duration-300 ease-in-out w-[40px] h-[40px] md:w-[50px] md:h-[50px]",children:[e.jsx("path",{d:"M8 4L16 12L8 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(2, 0)"}),e.jsx("path",{d:"M8 4L16 12L8 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(-5, 0)"})]})]})]})}),P=O;export{W as default};
