import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.DtoOFyvK.js";import{g as R,c as A}from"./config.BD8tWXmp.js";const L={src:"/_astro/Diseno.DU0-QbTs.webp"},T={src:"/_astro/logo-blanco-tami.BqjAaMyp.gif"},g="asesoriaModalLastClosed",y=180*1e3,H=()=>{const[M,d]=o.useState(!1),[C,h]=o.useState(!1),[m,b]=o.useState(""),[u,w]=o.useState(""),[f,p]=o.useState(""),[l,n]=o.useState({}),[v,S]=o.useState(!1),[j,k]=o.useState(""),E=o.useRef(0),x=o.useRef(!1),a=o.useRef(!1);o.useEffect(()=>{const e=parseInt(localStorage.getItem(g)||"0",10);if(Date.now()-e>=y&&!a.current){const c=setTimeout(()=>{d(!0),a.current=!0},2e3);return()=>clearTimeout(c)}},[]);const D=()=>{b(""),w(""),p(""),n({})};o.useEffect(()=>{const e=()=>{d(!0),a.current=!0};return window.addEventListener("open-scroll-modal",e),()=>window.removeEventListener("open-scroll-modal",e)},[]),o.useEffect(()=>{const e=()=>{const s=window.scrollY,c=s<E.current?"up":"down";if(E.current=s,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(x.current=!0),x.current&&c==="up"&&!a.current){const i=parseInt(localStorage.getItem(g)||"0",10);if(Date.now()-i<y)return;d(!0),a.current=!0,x.current=!1}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const N=()=>{h(!0),setTimeout(()=>{d(!1),h(!1),D(),localStorage.setItem(g,Date.now().toString()),a.current=!1},300)},I=()=>{const e={};return(m.trim().length<3||m.trim().length>75)&&(e.nombre="El nombre debe tener entre 3 y 75 caracteres."),/^\d{7,15}$/.test(u.trim())||(e.telefono="El teléfono debe tener entre 7 y 15 dígitos numéricos."),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.trim())||(e.correo="El correo no es válido."),n(e),Object.keys(e).length===0},O=async e=>{if(e.preventDefault(),!!I()){S(!0);try{const s=new FormData;s.append("name",m),s.append("email",f),s.append("celular",u);const c=await fetch(R(A.endpoints.clientes.create),{method:"POST",body:s});if(!c.ok){const r=await c.json().catch(()=>null);if(console.error("[ScrollModal] Error al enviar:",r),r?.errors){const i={};r.errors.name&&(i.nombre=r.errors.name.join(" ")),r.errors.celular&&(i.telefono=r.errors.celular.join(" ")),r.errors.email&&(i.correo=r.errors.email.join(" ")),n(i)}else n({general:"No se pudo enviar la información. Intenta nuevamente."});return}console.log("[ScrollModal] Enviado exitosamente:",{nombre:m,telefono:u,correo:f}),n({general:"✅ Información enviada con éxito ✅"}),setTimeout(()=>{N(),n({})},1500)}catch(s){console.error("[ScrollModal] Error al enviar:",s),n({general:s.message||"Error desconocido."})}finally{S(!1)}}};return M?t.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center px-4 modal-overlay",children:t.jsxs("div",{className:`bg-white flex flex-col sm:flex-row overflow-hidden shadow-lg w-[90%] max-w-md sm:max-w-3xl relative ${C?"animate-slideOut":"animate-slideIn"}`,children:[t.jsxs("div",{className:"hidden sm:block w-2/5 relative",children:[t.jsx("img",{src:L.src,alt:"Asesoría",className:"w-full h-full object-cover"}),t.jsx("img",{src:T.src,alt:"LogoTami",className:"absolute top-4 left-4 w-10 h-12"})]}),t.jsx("div",{className:"w-full sm:w-3/5 bg-gradient-to-b from-orange-300 to-teal-600 p-6 text-white relative",children:t.jsxs("div",{className:"py-6 sm:py-10 mx-2 sm:mx-8 min-h-[420px]",children:[t.jsx("button",{onClick:N,"aria-label":"Cerrar modal",className:"absolute top-4 right-5 text-md text-white hover:text-gray-300",children:"X"}),t.jsx("h2",{className:"text-xl sm:text-3xl font-bold text-center sm:mt-3 mb-4",children:"¡RECIBE UNA ASESORÍA GRATIS!"}),t.jsxs("form",{onSubmit:O,className:"flex flex-col gap-1",children:[t.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Nombre"}),t.jsx("input",{type:"text",value:m,onChange:e=>b(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1"}),t.jsx("p",{className:"text-sm text-yellow-100 mb-3 h-5",children:l.nombre||" "}),t.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Teléfono"}),t.jsx("input",{type:"tel",value:u,onChange:e=>w(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1"}),t.jsx("p",{className:"text-sm text-yellow-100 mb-3 h-5",children:l.telefono||" "}),t.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Correo"}),t.jsx("input",{type:"email",value:f,onChange:e=>p(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1"}),t.jsx("p",{className:`text-sm text-center mb-3 h-5 ${l.correo||l.general?"text-red-100":j?"text-green-100":"text-yellow-100"}`,children:l.correo||l.general||j||" "}),t.jsx("button",{type:"submit",disabled:v,className:"bg-orange-300 hover:bg-orange-400 text-white w-full sm:max-w-fit p-3 sm:p-4 text-xl sm:text-3xl font-bold rounded-xl mx-auto text-center",children:v?"Enviando...":"¡HABLEMOS!"})]})]})})]})}):null};export{H as default};
