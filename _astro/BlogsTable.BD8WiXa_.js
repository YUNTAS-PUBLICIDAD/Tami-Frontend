import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DtoOFyvK.js";import{F as O,f as R,g as V,a as U,d as T}from"./index.BT90q9ig.js";import{g as f,c as v}from"./config.BD8tWXmp.js";import{S as b}from"./sweetalert2.esm.all.BQIkj5Wb.js";const q=({onBlogAdded:F,isOpen:x,onClose:c,blogToEdit:o})=>{const[m,_]=i.useState(!1),[S,h]=i.useState(!1),[L,y]=i.useState([]),[r,u]=i.useState({titulo:"",link:"",subtitulo1:"",subtitulo2:"",video_url:"",video_titulo:"",producto_id:"",miniatura:null,imagenes:[{imagen:null,parrafo:""},{imagen:null,parrafo:""}]});i.useEffect(()=>{x!==void 0&&_(x)},[x]),i.useEffect(()=>{if(m){console.log("✅ useEffect ACTIVADO para PRODUCTOS");const t=f(v.endpoints.productos.list);console.log("🔗 URL de productos:",t),fetch(t,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(s=>(console.log("📦 Respuesta FETCH cruda:",s),s.json())).then(s=>{console.log("📦 JSON de productos:",s),Array.isArray(s?.data)?(console.log("✅ Es un array:",s.data),y(s.data)):(console.error("❌ NO es un array:",s),y([]))}).catch(s=>{console.error("🚫 Error en FETCH productos:",s)})}},[m]),i.useEffect(()=>{m&&fetch(f(v.endpoints.productos.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(t=>t.json()).then(t=>{Array.isArray(t?.data)?y(t.data):(console.error("❌ El formato de productos no es un array:",t),y([]))}).catch(t=>console.error("Error al obtener productos:",t))},[m]),i.useEffect(()=>{m&&u(o?{titulo:o.titulo||"",link:o.link||"",subtitulo1:o.subtitulo1||"",subtitulo2:o.subtitulo2||"",video_url:o.video_url||"",video_titulo:o.video_titulo||"",producto_id:o.producto_id||"",miniatura:null,imagenes:o.imagenes?.map(t=>({imagen:null,parrafo:t.parrafo||""}))||[{imagen:null,parrafo:""},{imagen:null,parrafo:""}]}:{titulo:"",link:"",subtitulo1:"",subtitulo2:"",video_url:"",video_titulo:"",producto_id:"",miniatura:null,imagenes:[{imagen:null,parrafo:""},{imagen:null,parrafo:""}]})},[m,o]);const p=t=>{const{name:s,value:l}=t.target;if(s==="link"){const n=l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replaceAll(" ","-");u(j=>({...j,link:n}))}else u(s==="producto_id"?n=>({...n,producto_id:l}):n=>({...n,[s]:l}))},A=t=>{t.target.files&&t.target.files[0]&&u({...r,miniatura:t.target.files[0]})},N=(t,s)=>{if(t.target.files&&t.target.files[0]){const l=[...r.imagenes];l[s]={...l[s],imagen:t.target.files[0]},u({...r,imagenes:l})}},B=(t,s)=>{const l=[...r.imagenes];l[s]={...l[s],parrafo:t.target.value},u({...r,imagenes:l})},w=()=>{_(!1),u({titulo:"",link:"",subtitulo1:"",subtitulo2:"",video_url:"",video_titulo:"",producto_id:"",miniatura:null,imagenes:[{imagen:null,parrafo:""},{imagen:null,parrafo:""}]})},k=async t=>{if(t.preventDefault(),h(!0),!r.titulo||!r.link||!r.subtitulo1||!r.subtitulo2||!r.video_url||!r.video_titulo||!r.producto_id||!o&&!r.miniatura||r.imagenes.some(s=>!o&&!s.imagen||!s.parrafo)){b.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."}),h(!1);return}try{const s=localStorage.getItem("token"),l=new FormData;l.append("titulo",r.titulo),l.append("link",r.link),l.append("subtitulo1",r.subtitulo1),l.append("subtitulo2",r.subtitulo2),l.append("video_url",r.video_url),l.append("video_titulo",r.video_titulo),l.append("producto_id",r.producto_id.toString()),r.miniatura&&l.append("miniatura",r.miniatura),r.imagenes.forEach(C=>{C.imagen&&l.append("imagenes[]",C.imagen),l.append("parrafos[]",C.parrafo),l.append("text_alt[]","Sin descripción")}),o&&l.append("_method","PUT");const n=o?`${f(v.endpoints.blogs.list)}/${o.id}`:f(v.endpoints.blogs.create),j=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:l}),E=await j.json();console.log("Respuesta del servidor:",E),j.ok?(await b.fire({icon:"success",title:o?"Blog actualizado exitosamente":"Blog añadido exitosamente",showConfirmButton:!0}),w(),F()):b.fire({icon:"error",title:"Error",text:`❌ Error: ${E.message||"Error al guardar blog"}`})}catch(s){console.error("Error al enviar los datos:",s),b.fire({icon:"error",title:"Error",text:`❌ ${s}`})}finally{h(!1)}};return e.jsx(e.Fragment,{children:(m||x)&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"max-h-[90vh] overflow-y-auto bg-white text-gray-800 p-8 rounded-xl w-full max-w-4xl shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-teal-600",children:o?"Editar Blog":"Añadir Nuevo Blog"}),e.jsx("button",{type:"button",onClick:c||w,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("form",{encType:"multipart/form-data",onSubmit:k,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título*"}),e.jsx("input",{type:"text",name:"titulo",value:r.titulo,onChange:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Link*"}),e.jsx("input",{type:"text",name:"link",value:r.link,onChange:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Párrafo*"}),e.jsx("input",{type:"text",name:"subtitulo1",value:r.subtitulo1,onChange:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción*"}),e.jsx("input",{type:"text",name:"subtitulo2",value:r.subtitulo2,onChange:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título Video*"}),e.jsx("input",{type:"text",name:"video_titulo",value:r.video_titulo,onChange:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"URL del Video*"}),e.jsx("input",{type:"text",name:"video_url",value:r.video_url,onChange:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Producto*"}),e.jsxs("select",{name:"producto_id",value:r.producto_id,onChange:p,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition",children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),L.map(t=>e.jsxs("option",{value:t.id,children:[" ",t.nombre]},t.id))]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Miniatura*"}),e.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),r.imagenes.map((t,s)=>e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Imagen Adicional ",s+1,"*"]}),e.jsx("div",{className:"flex items-center gap-4 mb-2",children:e.jsx("label",{className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-teal-500 transition",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:l=>N(l,s),className:"hidden"}),e.jsx("p",{className:"text-center text-gray-500",children:t.imagen?t.imagen.name:"Seleccionar archivo"})]})})}),e.jsx("textarea",{onChange:l=>B(l,s),value:t.parrafo,placeholder:"Descripción de la imagen...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition min-h-24"})]},s)),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:c||w,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition shadow-md flex items-center justify-center gap-2 min-w-[140px]",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Guardando..."]}):o?"Actualizar Blog":"Guardar Blog"})]})]})]})})})},Q=()=>{const[F,x]=i.useState([]),[c,o]=i.useState(1),[m,_]=i.useState(""),[S,h]=i.useState(!1),[L,y]=i.useState(!0),[r,u]=i.useState(null),[p,A]=i.useState(null),N=6,B=async()=>{y(!0);try{const d=await(await fetch(f(v.endpoints.blogs.list))).json();Array.isArray(d?.data)?x(d.data):(console.warn("⚠️ 'data' no es un array válido:",d?.data),x([]))}catch(a){console.error("❌ Error al cargar datos:",a),x([])}finally{y(!1)}};i.useEffect(()=>{B()},[]);const w=()=>{B(),h(!1)},k=F.filter(a=>a.titulo.toLowerCase().includes(m.toLowerCase())||a.subtitulo2.toLowerCase().includes(m.toLowerCase())),t=c*N,s=t-N,l=k.slice(s,t),n=Math.ceil(k.length/N),j=async a=>{const d=localStorage.getItem("token");if((await b.fire({title:"¿Estás seguro de que deseas eliminar este blog?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await fetch(f(v.endpoints.blogs.delete(a)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}})).ok?(x($=>$.filter(I=>I.id!==a)),await b.fire("Eliminado","Blog eliminado exitosamente","success")):await b.fire("Error","Error al eliminar el blog","error")}catch(D){console.error("Error al eliminar:",D),await b.fire("Error","Error al conectar con el servidor","error")}},E=()=>{h(!0)},C=a=>{A(a),h(!0)},M=a=>{u(a)},P=()=>{u(null)},z=({blog:a,onClose:d})=>a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`${f("")}${a.imagenes[0]?.ruta_imagen}`,alt:a.titulo,className:"w-full h-64 object-cover rounded-t-xl"}),e.jsx("button",{onClick:d,className:"absolute top-4 right-4 bg-white rounded-full p-2 shadow-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-teal-700 mb-2",children:a.titulo}),e.jsx("p",{className:"text-gray-500 mb-4",children:a.created_at?new Date(a.created_at).toLocaleDateString():"Fecha no disponible"}),e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("h3",{className:"text-xl font-semibold text-teal-600 mb-2",children:a.subtitulo1}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-medium text-teal-600 mb-2",children:"Acerca de este blog"}),e.jsx("p",{className:"text-gray-700",children:a.subtitulo2})]}),a.parrafos?.map((g,D)=>e.jsx("p",{className:"text-gray-700 mb-4",children:g.parrafo},D)),a.video_id?.trim()&&e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-medium text-teal-600 mb-2",children:a.video_titulo||"Video relacionado"}),e.jsx("div",{className:"aspect-w-16 aspect-h-9",children:e.jsx("iframe",{src:`https://www.youtube.com/embed/${a.video_id.trim()}`,className:"w-full h-64 rounded-lg",allowFullScreen:!0})})]})]})]})]})}):null;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 min-h-screen pb-12 sm:pb-16 md:pb-20 lg:pb-24 xl:pb-28",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-600 to-teal-400 text-white p-8 shadow-md",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Gestión de Blog"}),e.jsx("p",{className:"text-teal-50",children:"Administra todas las publicaciones del blog de tu empresa"})]})}),e.jsx("div",{className:"container mx-auto px-4 -mt-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(O,{className:"text-gray-400 dark:text-gray-300"})}),e.jsx("input",{type:"text",className:"pl-10 pr-4 py-2 w-full border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-teal-500 focus:border-teal-500",placeholder:"Buscar blogs...",value:m,onChange:a=>_(a.target.value)})]}),e.jsxs("button",{type:"button",onClick:E,className:"flex items-center gap-2 bg-teal-600 text-white px-4 py-2 rounded-full shadow hover:bg-teal-700 flex-shrink-0",children:[e.jsx(R,{}),"Añadir Blog"]}),e.jsx(q,{onBlogAdded:w,isOpen:S,onClose:()=>{h(!1),A(null)},blogToEdit:p})]}),L?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})}):l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx("img",{src:`${f("")}${a.imagenes[0]?.ruta_imagen}`,alt:a.titulo,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-0 right-0 m-2 flex space-x-1",children:[e.jsx("button",{onClick:()=>M(a),className:"p-2 bg-white dark:bg-gray-900 rounded-full hover:bg-teal-50 dark:hover:bg-gray-700 text-teal-600 shadow-md",title:"Vista previa",children:e.jsx(V,{size:16})}),e.jsx("button",{className:"p-2 bg-white dark:bg-gray-900 rounded-full hover:bg-yellow-50 dark:hover:bg-gray-700 text-yellow-600 shadow-md",title:"Editar",onClick:()=>C(a),children:e.jsx(U,{size:16})}),e.jsx("button",{onClick:()=>j(a.id),className:"p-2 bg-white dark:bg-gray-900 rounded-full hover:bg-red-50 dark:hover:bg-gray-700 text-red-600 shadow-md",title:"Eliminar",children:e.jsx(T,{size:16})})]})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 line-clamp-1",children:a.titulo}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mb-3 line-clamp-2",children:a.subtitulo2}),e.jsxs("div",{className:"mt-auto pt-4 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",a.id]}),e.jsx("span",{className:"px-3 py-1 bg-teal-50 dark:bg-teal-800 text-teal-600 dark:text-teal-200 rounded-full text-xs font-medium",children:"Blog"})]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900 dark:text-gray-100",children:"No se encontraron blogs"}),e.jsx("p",{className:"mt-1 text-gray-500 dark:text-gray-400",children:"Intenta con otra búsqueda o crea un nuevo blog."})]}),k.length>0&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx("button",{onClick:()=>o(a=>Math.max(a-1,1)),disabled:c===1,className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 text-sm text-gray-700 dark:text-gray-200",children:"Anterior"}),Array.from({length:Math.min(n,5)},(a,d)=>{let g;return n<=5||c<=3?g=d+1:c>=n-2?g=n-4+d:g=c-2+d,e.jsx("button",{onClick:()=>o(g),className:`px-3 py-1 border rounded-md text-sm ${c===g?"bg-teal-500 text-white border-teal-500":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:g},d)}),e.jsx("button",{onClick:()=>o(a=>Math.min(a+1,n)),disabled:c===n,className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 text-sm text-gray-700 dark:text-gray-200",children:"Siguiente"})]})]})}),r&&e.jsx(z,{blog:r,onClose:P})]})};export{Q as default};
