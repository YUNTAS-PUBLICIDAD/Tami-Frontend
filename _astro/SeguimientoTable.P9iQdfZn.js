import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.DYrVU9rO.js";import{g as D,c as P,h as R,e as q,f as G}from"./index.CkUCwCrR.js";import{g as A,c as F}from"./config.DrCsXt2T.js";import{S as g}from"./sweetalert2.esm.all.BbQndx0i.js";import{L as J,S as U,T as _,a as H,b as T,c as V,d as K,e as v}from"./LoadingComponent.DW7NWWCF.js";import{E as Q}from"./ErrorComponent.Co0ZmcSm.js";import"./iconBase.Uj_LM8Gb.js";const I=()=>{const o=()=>{const n=localStorage.getItem("token");if(!n)throw new Error("No se encontró el token");return n};return{addCliente:async n=>{const r=o(),i=A(F.endpoints.clientes.create),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)});if(!s.ok){let f=null;try{f=await s.json()}catch{}throw f?new Error(JSON.stringify(f)):new Error("Error al agregar cliente")}return(await s.json()).data},updateCliente:async(n,r)=>{const i=o(),s=A(F.endpoints.clientes.update(n)),l=await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)});if(!l.ok)throw new Error("Error al actualizar cliente");return(await l.json()).data},deleteCliente:async n=>{const r=o(),i=A(F.endpoints.clientes.delete(n)),s=await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!s.ok)throw new Error("Error al eliminar cliente");return await s.json()}}},W=(o,x)=>{const[a,d]=c.useState({name:"",celular:"",email:""}),[n,r]=c.useState({}),[i,s]=c.useState(!1),{addCliente:l,updateCliente:f}=I();c.useEffect(()=>{o?(d({name:o.name,celular:o.celular,email:o.email}),s(!0),r({})):j()},[o]);const b=y=>{d({...a,[y.target.name]:y.target.value}),r({...n,[y.target.name]:""})},C=async y=>{y.preventDefault(),r({});const{name:S,celular:m,email:k}=a;if(!S.trim()||!m.trim()||!k.trim()){await g.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."});return}if(!/^\d+$/.test(m)){await g.fire({icon:"warning",title:"Teléfono inválido",text:"⚠️ El teléfono solo debe contener números."});return}try{i?(await f(o.id,{name:S,celular:m,email:k}),await g.fire({icon:"success",title:"Cliente actualizado",text:"✅ Cliente actualizado correctamente"})):(await l({name:S,celular:m,email:k}),await g.fire({icon:"success",title:"Cliente registrado",text:"✅ Cliente registrado exitosamente"})),x?.(),j()}catch(w){console.error("❌ Error en la operación:",w);let p={};try{const u=JSON.parse(w.message);if(u.errors)u.errors.name&&(p.name=u.errors.name.join(" ")),u.errors.celular&&(p.celular=u.errors.celular.join(" ")),u.errors.email&&(p.email=u.errors.email.join(" "));else if(u.message){await g.fire({icon:"error",title:"Error",text:`❌ ${u.message}`});return}else{await g.fire({icon:"error",title:"Error",text:"❌ Error desconocido."});return}}catch{await g.fire({icon:"error",title:"Error",text:`❌ ${w.message||"Error desconocido"}`});return}r({name:p.name||"",celular:p.celular||"",email:p.email||""})}},j=()=>{d({name:"",celular:"",email:""}),r({}),s(!1)};return{formData:a,errors:n,handleChange:b,handleSubmit:C,resetForm:j}},X=({isOpen:o,setIsOpen:x,cliente:a,onRefetch:d})=>{const{formData:n,handleChange:r,handleSubmit:i,errors:s,resetForm:l}=W(a,()=>{d(),x(!1)});return o?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl px-6 sm:px-8 py-8 sm:py-10 animate-scaleIn",children:[e.jsx("h2",{className:"text-2xl font-bold text-teal-600 mb-6 text-center",children:a?"Editar Cliente":"Añadir Cliente"}),e.jsxs("form",{onSubmit:i,className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",className:"text-sm font-medium text-teal-700 mb-1",children:"Nombres"}),e.jsx("input",{id:"name",name:"name",type:"text",value:n.name,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${s.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. Juan Pérez"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:s.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"celular",className:"text-sm font-medium text-teal-700 mb-1",children:"Teléfono"}),e.jsx("input",{id:"celular",name:"celular",type:"text",value:n.celular,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${s.celular?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. 987654321"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:s.celular||" "})]}),e.jsxs("div",{className:"flex flex-col sm:col-span-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-teal-700 mb-1",children:"Gmail"}),e.jsx("input",{id:"email",name:"email",type:"email",value:n.email,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${s.email?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. cliente@gmail.com"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:s.email||" "})]}),e.jsxs("div",{className:"sm:col-span-2 flex flex-col sm:flex-row justify-end items-center gap-3 mt-4",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto bg-teal-600 text-white px-5 py-2 rounded-lg hover:bg-teal-700 transition shadow",children:a?"Guardar Cambios":"Añadir Cliente"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),l()},className:"w-full sm:w-auto bg-gray-100 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-200 transition",children:"Cancelar"})]})]})]})}):null},Y=({isOpen:o,setIsOpen:x,clienteId:a,onRefetch:d})=>{const{deleteCliente:n}=I(),r=async()=>{if((await g.fire({title:"¿Eliminar cliente?",text:"Esta acción es permanente y no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await n(a),g.fire("Eliminado","El cliente ha sido eliminado exitosamente.","success"),d()}catch(s){console.error("Error al eliminar cliente:",s),g.fire("Error","No se pudo eliminar el cliente.","error")}x(!1)};return o&&r(),null},Z=o=>{const[x,a]=c.useState([]),[d,n]=c.useState(!0),[r,i]=c.useState(null);return c.useEffect(()=>{(async()=>{n(!0),i(null);try{const l=localStorage.getItem("token");if(!l)throw new Error("No se encontró el token de autenticación");const f=`${A(F.endpoints.clientes.list)}`,b=await fetch(f,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});if(!b.ok)throw new Error(`Error al obtener clientes: ${b.statusText}`);const C=await b.json(),j=Array.isArray(C.data)?C.data:C.data?.data||[];a(j)}catch(l){console.error("Error en fetchClientes:",l),i(l instanceof Error?l.message:"Ocurrió un error desconocido")}finally{n(!1)}})()},[o]),{clientes:x,loading:d,error:r}},ie=()=>{const[o,x]=c.useState(!1),[a,d]=c.useState(1),{clientes:n,loading:r,error:i}=Z(o),[s,l]=c.useState(!1),[f,b]=c.useState(null),[C,j]=c.useState(!1),[y,S]=c.useState(null),[m,k]=c.useState("");c.useEffect(()=>{d(1)},[m]);const w=5,p=n.filter(t=>t.name.toLowerCase().includes(m.toLowerCase())||t.email.toLowerCase().includes(m.toLowerCase())||t.celular?.toLowerCase().includes(m.toLowerCase())||t.id.toString().includes(m)),u=p.length,N=Math.ceil(u/w),O=p.slice((a-1)*w,a*w),$=()=>x(t=>!t),M=t=>{b(t),l(!0)},z=()=>{b(null),l(!0)},B=t=>{S(t),j(!0)},L=t=>{x(h=>!h),l(!1),g.fire({icon:"success",title:"Operación exitosa",text:t||"El cliente se ha guardado correctamente",confirmButtonColor:"#14b8a6"})};return r?e.jsx(J,{message:"Cargando clientes..."}):i?e.jsx(Q,{handleRefetch:$,error:i}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-teal-600 px-8 py-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-extrabold flex items-center gap-3 text-white",children:[e.jsx(D,{}),e.jsx("span",{children:"Gestión de Clientes"})]}),e.jsx("p",{className:"text-teal-50 mt-2 text-lg",children:"Seguimiento y administración de clientes"})]}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 bg-white text-teal-600 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold shadow-md hover:shadow-lg",children:[e.jsx(P,{})," Agregar Cliente"]})]})}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center",children:[e.jsx(U,{placeholder:"Buscar clientes...",value:m,onChange:k}),e.jsxs("button",{onClick:$,disabled:r,className:"flex items-center gap-2 bg-white text-teal-600 border-2 border-teal-500 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold w-full sm:w-auto justify-center shadow-sm",children:[e.jsx(R,{className:`h-4 w-4 ${r?"animate-spin":""}`}),r?"Cargando...":"Actualizar"]})]}),e.jsx("div",{className:"flex items-center justify-between bg-teal-50 p-4 rounded-xl border border-teal-100 shadow-sm",children:e.jsxs("div",{className:"text-sm font-medium text-teal-700 flex items-center gap-2",children:[e.jsx("span",{className:"bg-teal-500 text-white text-sm font-bold py-1 px-3 rounded-full",children:u}),u===1?"cliente":"clientes"," encontrados"]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_,{children:[e.jsx(H,{children:e.jsx(T,{children:["ID","NOMBRE","EMAIL","TELÉFONO","ACCIÓN"].map((t,h)=>e.jsx(V,{className:"text-xs whitespace-nowrap",children:t},h))})}),e.jsx(K,{children:O.length===0?e.jsx(T,{children:e.jsx(v,{colSpan:7,children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(D,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:m?"No se encontraron clientes que coincidan con tu búsqueda":"No hay clientes registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:m?"Intenta con otros términos de búsqueda":"Comienza agregando clientes a tu sistema con el botón 'Agregar Cliente'"})]})})}):e.jsxs(e.Fragment,{children:[O.map(t=>e.jsxs(T,{children:[e.jsxs(v,{className:"px-6 py-4 font-medium whitespace-nowrap text-teal-700",children:["#",t.id]}),e.jsx(v,{children:t.name}),e.jsx(v,{className:"text-blue-500",children:t.email}),e.jsx(v,{children:t.celular||e.jsx("span",{className:"text-gray-400 italic text-xs",children:"No disponible"})}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-green-100 text-green-600 transition-colors duration-200 border border-transparent hover:border-green-200",title:"Editar",onClick:()=>M(t),children:e.jsx(q,{size:18})}),e.jsx("button",{className:"p-2 rounded-full text-red-500 border border-transparent transition-colors duration-200 hover:bg-red-100 hover:border-red-200",title:"Eliminar",onClick:()=>B(t.id),children:e.jsx(G,{size:18})})]})})]},t.id)),Array.from({length:w-O.length}).map((t,h)=>e.jsxs(T,{className:"h-17",children:[" ",e.jsx(v,{colSpan:5,className:"px-6 py-4",children:" "})]},`empty-${h}`))]})})]})}),p.length>0&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8 px-4 pb-6",children:[e.jsx("button",{onClick:()=>d(t=>Math.max(t-1,1)),disabled:a===1,className:`${a===1?"":"cursor-pointer"} px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 text-sm text-gray-700 dark:text-gray-200`,children:"Anterior"}),Array.from({length:Math.min(N,5)},(t,h)=>{let E;return N<=5||a<=3?E=h+1:a>=N-2?E=N-4+h:E=a-2+h,e.jsx("button",{onClick:()=>d(E),className:`px-3 py-1 border rounded-md text-sm cursor-pointer ${a===E?"bg-teal-500 text-white border-teal-500":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:E},h)}),e.jsx("button",{onClick:()=>d(t=>Math.min(t+1,N)),disabled:a===N,className:`${a===N?"":"cursor-pointer"} px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 text-sm text-gray-700 dark:text-gray-200`,children:"Siguiente"})]})]}),e.jsx(X,{isOpen:s,setIsOpen:l,cliente:f,onRefetch:L}),y!==null&&e.jsx(Y,{isOpen:C,setIsOpen:j,clienteId:y,onRefetch:$})]})};export{ie as default};
