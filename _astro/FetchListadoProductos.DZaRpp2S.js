import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{c as E,g as R}from"./config.BZJ3FbET.js";import{R as C,r}from"./index.Be8AcK8B.js";const w="productos_cache",k=300*1e3,A=()=>{try{const n=localStorage.getItem(w);if(!n)return null;const{data:t,timestamp:a}=JSON.parse(n);return Date.now()-a>k?(localStorage.removeItem(w),null):t}catch{return null}},$=n=>{try{const t={data:n,timestamp:Date.now()};localStorage.setItem(w,JSON.stringify(t))}catch{}},M=E.apiUrl;function T(){const[n,t]=r.useState([]),[a,l]=r.useState(!0),[i,u]=r.useState(null),[c,m]=r.useState(!1),o=r.useRef(null),g=r.useCallback(async(f=!0)=>{try{if(o.current&&o.current.abort(),l(!0),u(null),m(!0),f){const s=A();if(s){const h=p(s);t(h.map((d,_)=>e.jsx(N,{...d},`${d.nombreSeccion}-${_}`))),l(!1),m(!1);return}}o.current=new AbortController;const x=await fetch(R(E.endpoints.productos.list),{signal:o.current.signal});if(!x.ok)throw new Error("Error al obtener productos");const v=(await x.json()).map(s=>{let h=[];return Array.isArray(s.imagenes)&&(h=s.imagenes.map(d=>({url_imagen:d.url_imagen||d.url||"",texto_alt_SEO:d.texto_alt_SEO||d.alt||"",imageTitle:d.imageTitle||""}))),{id:s.id,nombre:s.nombre,link:s.link,titulo:s.titulo,subtitulo:s.subtitulo,lema:s.lema,descripcion:s.descripcion,especificaciones:s.especificaciones||{},productos_relacionados:s.productos_relacionados||[],imagenes:h,stock:s.stock,precio:parseFloat(s.precio),seccion:s.seccion,createdAt:s.created_at}});$(v);const I=p(v);t(I.map((s,h)=>e.jsx(N,{...s},`${s.nombreSeccion}-${h}`)))}catch(x){if(x.name==="AbortError")return;console.error("Error cargando productos:",x),u("Error al cargar los productos. Por favor, intenta nuevamente.")}finally{l(!1),m(!1)}},[]),p=r.useMemo(()=>f=>["Negocio","Decoración","Maquinaria"].map(y=>({nombreSeccion:y,productosDeLaSeccion:f.filter(j=>j.seccion===y)})),[]),b=r.useCallback(()=>{c||g(!1)},[g,c]);return r.useEffect(()=>(g(),()=>{o.current&&o.current.abort()}),[g]),a?e.jsx(O,{}):i?e.jsx("section",{className:"w-full flex flex-col items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:i}),e.jsx("button",{onClick:b,disabled:c,className:`px-6 py-2 rounded-lg transition-colors ${c?"bg-gray-400 cursor-not-allowed":"bg-teal-600 hover:bg-teal-700 text-white"}`,children:c?"Cargando...":"Reintentar"})]})}):e.jsx("section",{className:"w-full grid grid-rows-auto",children:n})}function O(){return e.jsx("section",{className:"w-full grid grid-rows-auto",children:[1,2,3].map(n=>e.jsx("div",{className:"flex justify-center relative py-6 sm:py-8 md:py-10",children:e.jsxs("div",{className:"relative w-[95%] xs:w-[90%] sm:w-4/5 place-self-center",children:[e.jsx("div",{className:"bg-gray-300 animate-pulse h-10 w-48 mb-6 rounded"}),e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 xs:gap-4 sm:gap-6 md:gap-8 mt-4 sm:mt-6",children:[1,2,3,4,5,6,7,8].map(t=>e.jsxs("div",{className:"my-4 sm:my-6 md:my-10 flex flex-col items-center",children:[e.jsx("div",{className:"bg-gray-300 animate-pulse rounded-[15%] w-4/5 h-4/5 md:h-56 md:w-56 mb-3"}),e.jsx("div",{className:"bg-gray-300 animate-pulse h-4 w-3/4 rounded"})]},t))})]})},n))})}const D=C.memo(function({nombreSeccion:t,productosDeLaSeccion:a}){const l=r.useMemo(()=>a.length===0?e.jsx("p",{className:"text-gray-400 text-lg col-span-full text-center py-8",children:"No hay productos en esta sección."}):a.map(i=>e.jsx(z,{producto:i},i.id)),[a]);return e.jsx("div",{className:"flex justify-center relative py-6 sm:py-8 md:py-10",id:t,children:e.jsxs("div",{className:"relative w-[95%] xs:w-[90%] sm:w-4/5 place-self-center",children:[e.jsx("h2",{className:`text-white bg-gradient-to-r from-teal-900 via-teal-700 py-2 sm:py-3
                       w-fit text-xl xs:text-2xl sm:text-3xl font-bold
                       ps-3 xs:ps-4 sm:ps-5 lg:ps-10
                       pe-8 xs:pe-12 sm:pe-16 lg:pe-28`,children:t}),e.jsxs("div",{className:`grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4
                       gap-2 xs:gap-4 sm:gap-6 md:gap-8
                       mt-4 sm:mt-6`,children:[a.length>0?a.map(i=>e.jsx(S,{producto:i},i.id)):e.jsx("p",{className:"text-gray-400 text-lg col-span-full text-center py-8",children:"No hay productos en esta sección."}),l]})]})})}),N=D;function P(n={}){const[t,a]=r.useState(!1),[l,i]=r.useState(!1),u=r.useRef(null);return r.useEffect(()=>{const c=u.current;if(!c)return;const m=new IntersectionObserver(([o])=>{a(o.isIntersecting),o.isIntersecting&&!l&&i(!0)},{threshold:.1,rootMargin:"100px",...n});return m.observe(c),()=>{m.unobserve(c)}},[l,n]),{targetRef:u,isIntersecting:t,hasIntersected:l}}const S=C.memo(function({producto:t}){const[a,l]=r.useState(!1),[i,u]=r.useState(!1),{targetRef:c,hasIntersected:m}=P(),o=r.useMemo(()=>{if(t.imagenes&&t.imagenes.length>0&&t.imagenes[0].url_imagen){const f=t.imagenes[0].url_imagen;return f.startsWith("http")?f:`${M.replace(/\/$/,"")}${f}`}return`https://placehold.co/300x300/e5e7eb/6b7280?text=${encodeURIComponent(t.nombre)}`},[t.imagenes,t.nombre]),g=r.useMemo(()=>({alt:t.imagenes[0]?.texto_alt_SEO||t.nombre,title:t.imagenes[0]?.texto_alt_SEO||t.imagenes[0]?.imageTitle}),[t.imagenes,t.nombre]),p=r.useCallback(()=>l(!0),[]),b=r.useCallback(()=>{u(!0),l(!0)},[]);return e.jsxs("a",{href:`/productos/${t.link}`,title:`Ver detalles de ${t.nombre}`,className:"my-4 sm:my-6 md:my-10 flex flex-col items-center group hover:cursor-pointer w-full",children:[e.jsxs("div",{ref:c,className:"bg-gray-300 rounded-[15%] place-self-center w-4/5 h-4/5 md:h-56 md:w-56 md:p-0 mb-3 overflow-hidden shadow-md group-hover:shadow-xl transition-shadow duration-300 relative",children:[!a&&!i&&e.jsx("div",{className:"absolute inset-0 bg-gray-300 animate-pulse flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})})}),m&&e.jsx("img",{src:o,alt:g.alt,title:g.title,loading:"lazy",onLoad:p,onError:b,className:`h-full w-full object-cover transition-all duration-500 ease-out group-hover:scale-110 ${a?"opacity-100":"opacity-0"}`,style:{aspectRatio:"1"}})]}),e.jsx("div",{className:"flex flex-row justify-center items-center text-teal-700 mt-3",children:e.jsx("div",{className:"flex-grow text-center group w-full px-2",children:e.jsx("h3",{className:"text-base sm:text-lg font-bold text-teal-700 leading-snug break-words whitespace-normal group-hover:scale-105 transition-transform duration-300 ease-in-out",children:t.nombre})})})]})}),z=S;export{T as default};
