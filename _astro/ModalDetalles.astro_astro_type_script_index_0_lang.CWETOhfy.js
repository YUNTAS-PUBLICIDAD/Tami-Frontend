import{c}from"./config.BZJ3FbET.js";const u={NEGOCIOS:{gradient:"from-sky-400 to-sky-600",title:"DESCARGA MÁS INFORMACIÓN GRATIS",btn:"bg-sky-400 hover:bg-sky-500 cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"},MAQUINARIA:{gradient:"from-emerald-400 to-teal-600",title:"DESCARGA TU <span class='scrollmodal-title'>GUÍA TÉCNICA GRATIS</span>",btn:"bg-emerald-400 hover:bg-emerald-500 cursor-pointer",buttonText:"¡SÍ, QUIERO MI GUÍA!"},DECORACIÓN:{gradient:"from-violet-500 to-indigo-700",title:"TU GUÍA DE DECORACIÓN EXCLUSIVA, GRATIS",btn:"bg-violet-500 hover:bg-violet-600 cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"}},i={"soldadora-lingba":"/images/popup/soldadora-lingba.webp","purificador-de-agua":"/images/popup/purificador-de-agua.webp","maquina-de-embalaje-de-te":"/images/popup/maquina-de-embalaje-de-te.webp","maquina-selladora-de-bolsas-para-solidos":"/images/popup/maquina-selladora-de-bolsas-para-solidos.webp","mesa-led-bar-alta-cuadrada":"/images/popup/mesa-led-bar-alta-cuadrada.webp","mesa-led-bar-alta":"/images/popup/mesa-led-bar-alta.webp","selladora-por-induccion":"/images/popup/selladora-por-induccion.webp","selladora-de-vaso-manual":"/images/popup/selladora-de-vaso-manual.webp","silla-bar-led-alta":"/images/popup/silla-bar-led-alta.webp","sillas-cuadradas-o-de-cubo":"/images/popup/sillas-cuadradas-o-de-cubo.webp","soldadora-spark-mig-250":"/images/popup/soldadora-spark-mig-250.webp","ventilador-holografico":"/images/popup/ventilador-holografico.webp","maquina-selladora-de-bolsas-para-liquidos":"/images/popup/maquina-selladora-de-bolsas-para-liquidos.webp",default:"/images/popup/default.webp"},g=document.getElementById("modal-form-container");g?.dataset.whatsapp;let m=u.NEGOCIOS;const v="asesoriaModalLastClosedDetalle",A=180*1e3;let f=!1,E=!1;function b(){w(),I();const e=document.getElementById("modal-cotizacion-producto"),o=document.getElementById("modal-cotizacion-mensaje");e&&o&&(e.classList.remove("hidden"),o.textContent="",f=!0)}function I(){const e=document.getElementById("modal-form-container"),o=document.getElementById("modal-product-img");if(!e||!o)return;const a=e.dataset.productLink||"";console.log("Link del producto desde dataset:",a);let t=i.default,l="Imagen por defecto";if(window.__detalleProducto){const d=window.__detalleProducto,r=d.producto_imagenes?.find(n=>n.tipo==="popup");r?.url_imagen?(t=`${c.apiUrl}${r.url_imagen}`,l=r.texto_alt_SEO||d.nombre||"Imagen del producto",console.log("Imagen popup encontrada desde API:",t)):(t=i[a]||i.default,l=`Imagen para ${a}`,console.log("Usando imagen hardcodeada o default:",t))}else t=i[a]||i.default,l=`Imagen para ${a}`,console.log("Producto no cargado, usando imagen hardcodeada:",t);const s=new Image;s.onload=function(){o.src=t,o.alt=l},s.onerror=function(){console.error("Error al cargar la imagen:",t),o.src=i.default,o.alt="Imagen por defecto"},s.src=t}function O(){const e=parseInt(localStorage.getItem(v)||"0",10);return Date.now()-e>=A}const C=document.getElementById("close-modal-cotizacion");C&&(C.onclick=()=>{const e=document.getElementById("modal-cotizacion-producto");e&&e.classList.add("hidden"),localStorage.setItem(v,Date.now().toString()),f=!1});const p=document.getElementById("form-cotizacion-producto");p&&(p.onsubmit=async e=>{e.preventDefault();const o=new FormData(p),a=o.get("nombre"),t="+51 "+o.get("telefono"),l=o.get("correo"),s=document.getElementById("modal-form-container")?.dataset.productLink;try{const r=await fetch(`${c.apiUrl}${c.endpoints.whatsapp.info}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:t,email:l,link:s})});if(r.ok){const n=await r.json();console.log("Mensaje enviado con éxito:",n)}else{const n=await r.json();console.error("Error al enviar mensaje:",n)}}catch(r){console.error("Error al enviar mensaje a WhatsApp:",r)}const d=document.getElementById("modal-cotizacion-mensaje");d&&(d.textContent="Enviado a WhatsApp ✅");try{if((await fetch(`${c.apiUrl}${c.endpoints.email.sendEmailByProductLink}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,celular:t,email:l,link:s})})).ok){const n=document.getElementById("modal-cotizacion-mensaje");n&&(n.textContent="Correo enviado con éxito ✅")}else{const n=document.getElementById("modal-cotizacion-mensaje");n&&(n.textContent="Error al enviar el correo. Intenta nuevamente.")}}catch(r){console.error("Error al enviar el formulario:",r);const n=document.getElementById("modal-cotizacion-mensaje");n&&(n.textContent="Error al enviar el correo. Intenta nuevamente.")}p.reset()});function w(){const e=document.getElementById("modal-form-container"),o=document.getElementById("modal-title"),a=document.getElementById("modal-submit-btn"),t=document.getElementById("modal-submit-btn");e&&(e.classList.remove("from-sky-400","to-sky-600","from-emerald-400","to-teal-600","from-violet-500","to-indigo-700"),e.classList.add("bg-gradient-to-b",...m.gradient.split(" "))),o&&(o.innerHTML=m.title),a&&(a.classList.remove("bg-sky-400","hover:bg-sky-500","bg-emerald-400","hover:bg-emerald-500","bg-violet-500","hover:bg-violet-600"),a.classList.add(...m.btn.split(" "),"text-white")),t&&(t.textContent=m.buttonText||"Enviar",t.classList.add("font-bold"))}function S(){document.querySelectorAll('[id^="btnQuotation"]').forEach(o=>{o.addEventListener("click",()=>{b()})})}window.addEventListener("open-scroll-modal",b);window.addEventListener("scroll",()=>{window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100>30&&!E&&O()&&!f&&(E=!0,b())});function y(){const e=document.getElementById("modal-form-container");if(!e)return;const a=(e.dataset.seccion||"NEGOCIOS").normalize?.("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase(),l={NEGOCIOS:"NEGOCIOS",MAQUINARIA:"MAQUINARIA",DECORACION:"DECORACIÓN"}[a]||"NEGOCIOS";m=u[l]||u.NEGOCIOS,w()}g&&new MutationObserver(o=>{o.forEach(a=>{a.attributeName==="data-seccion"&&y(),a.attributeName==="data-product-link"&&I()})}).observe(g,{attributes:!0,attributeFilter:["data-seccion","data-product-link"]});document.addEventListener("DOMContentLoaded",function(){localStorage.removeItem("asesoriaModalLastClosedDetalle"),y(),I(),S()});
