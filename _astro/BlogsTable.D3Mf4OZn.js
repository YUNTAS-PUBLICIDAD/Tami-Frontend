import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.BJfUAbRs.js";import{F as P,g as O,a as $,d as R}from"./index.LJaOrOyx.js";import{g as N,c as w}from"./config.WymI9u0k.js";import{S as h}from"./sweetalert2.esm.all.BKGx94Is.js";const V=({onBlogAdded:k,isOpen:f,onClose:n,blogToEdit:b})=>{const[u,C]=o.useState(!1),[S,x]=o.useState(!1),[_,j]=o.useState([]),[a,g]=o.useState({titulo:"",link:"",subtitulo1:"",subtitulo2:"",subtitulo3:"",video_id:"",video_titulo:"",producto_id:0,imagenes:[{imagen:null,parrafo:""},{imagen:null,parrafo:""}]});o.useEffect(()=>{u&&fetch(N(w.endpoints.blogs.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(s=>s.json()).then(s=>{s?.data?.map(l=>parseInt(l.link)).filter(l=>Number.isInteger(l)&&l>0)}).catch(s=>console.error("Error al obtener blogs:",s))},[u]),o.useEffect(()=>{u&&fetch(N(w.endpoints.productos.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(s=>s.json()).then(s=>{Array.isArray(s?.data)?j(s.data):(console.error("❌ El formato de productos no es un array:",s),j([]))}).catch(s=>console.error("Error al obtener productos:",s))},[u]);const d=s=>{const{name:l,value:r}=s.target;if(l==="link"){const m=r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replaceAll(" ","-");g(c=>({...c,link:m}))}else g(m=>({...m,[l]:r}))},E=(s,l)=>{if(s.target.files&&s.target.files[0]){const r=[...a.imagenes];r[l]={...r[l],imagen:s.target.files[0]},g({...a,imagenes:r})}},v=(s,l)=>{const r=[...a.imagenes];r[l]={...r[l],parrafo:s.target.value},g({...a,imagenes:r})},y=()=>{C(!1),g({titulo:"",link:"",subtitulo1:"",subtitulo2:"",subtitulo3:"",video_id:"",video_titulo:"",producto_id:0,imagenes:[{imagen:null,parrafo:""},{imagen:null,parrafo:""}]})},A=async s=>{if(s.preventDefault(),x(!0),x(!0),!a.titulo||!a.link||!a.subtitulo1||!a.subtitulo2||!a.subtitulo3||!a.video_id||!a.video_titulo||!a.producto_id||a.imagenes.some(l=>!l.imagen||!l.parrafo)){h.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."}),x(!1);return}try{const l=localStorage.getItem("token"),r=new FormData;r.append("titulo",a.titulo),r.append("link",a.link),r.append("subtitulo1",a.subtitulo1),r.append("subtitulo2",a.subtitulo2),r.append("subtitulo3",a.subtitulo3),r.append("video_url",a.video_id),r.append("video_id","placeholder"),r.append("video_titulo",a.video_titulo),r.append("producto_id",a.producto_id.toString()),a.imagenes.forEach(B=>{r.append("imagenes[]",B.imagen),r.append("parrafos[]",B.parrafo),r.append("text_alt[]","Sin descripción")});const m=await fetch(N(w.endpoints.blogs.create),{method:"POST",headers:{Authorization:`Bearer ${l}`},body:r}),c=await m.json();console.log("Respuesta del servidor:",c),m.ok?(await h.fire({icon:"success",title:"Blog añadido exitosamente",showConfirmButton:!0}),y(),k()):h.fire({icon:"error",title:"Error",text:`❌ Error: ${c.message||"Error al crear blog"}`})}catch(l){console.error("Error al enviar los datos:",l),h.fire({icon:"error",title:"Error",text:`❌ ${l}`})}finally{x(!1)}k()};return e.jsxs(e.Fragment,{children:[!f&&e.jsx("button",{onClick:()=>C(!0),className:"mt-4 bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105",children:"Añadir Blog"}),(u||f)&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"max-h-[90vh] overflow-y-auto bg-white text-gray-800 p-8 rounded-xl w-full max-w-4xl shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-teal-600",children:b?"Editar Blog":"Añadir Nuevo Blog"}),e.jsx("button",{onClick:n||y,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("form",{encType:"multipart/form-data",onSubmit:A,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título*"}),e.jsx("input",{type:"text",name:"titulo",value:a.titulo,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Link*"}),e.jsx("input",{type:"text",name:"link",value:a.link,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Link*"}),e.jsx("input",{type:"text",name:"link",value:a.link,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Párrafo*"}),e.jsx("input",{type:"text",name:"subtitulo1",value:a.subtitulo1,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción*"}),e.jsx("input",{type:"text",name:"subtitulo2",value:a.subtitulo2,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtítulo Beneficio*"}),e.jsx("input",{type:"text",name:"subtitulo3",value:a.subtitulo3,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título Video*"}),e.jsx("input",{type:"text",name:"video_titulo",value:a.video_titulo,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"URL del Video*"}),e.jsx("input",{type:"text",name:"video_id",value:a.video_id,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Producto*"}),e.jsxs("select",{name:"producto_id",value:a.producto_id,onChange:d,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition",children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),_.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Producto*"}),e.jsxs("select",{name:"producto_id",value:a.producto_id,onChange:d,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition",children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),_.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})]}),a.imagenes.map((s,l)=>e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Imagen Adicional ",l+1,"*"]}),e.jsx("div",{className:"flex items-center gap-4 mb-2",children:e.jsx("label",{className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-teal-500 transition",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:r=>E(r,l),className:"hidden"}),e.jsx("p",{className:"text-center text-gray-500",children:s.imagen?s.imagen.name:"Seleccionar archivo"})]})})}),e.jsx("textarea",{onChange:r=>v(r,l),value:s.parrafo,placeholder:"Descripción de la imagen...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition min-h-24"})]},l)),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:n||y,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition shadow-md flex items-center justify-center gap-2 min-w-[140px]",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Guardando..."]}):b?"Actualizar Blog":"Guardar Blog"})]})]})]})})]})},J=()=>{const[k,f]=o.useState([]),[n,b]=o.useState(1),[u,C]=o.useState(""),[S,x]=o.useState(!1),[_,j]=o.useState(!0),[a,g]=o.useState(null),[d,E]=o.useState(null),v=6,y=async()=>{j(!0);try{const i=await(await fetch(N(w.endpoints.blogs.list))).json();Array.isArray(i?.data)?f(i.data):(console.warn("⚠️ 'data' no es un array válido:",i?.data),f([]))}catch(t){console.error("❌ Error al cargar datos:",t),f([])}finally{j(!1)}};o.useEffect(()=>{y()},[]);const A=()=>{y(),x(!1)},s=k.filter(t=>t.titulo.toLowerCase().includes(u.toLowerCase())||t.subtitulo2.toLowerCase().includes(u.toLowerCase())),l=n*v,r=l-v,m=s.slice(r,l),c=Math.ceil(s.length/v),B=async t=>{const i=localStorage.getItem("token");if((await h.fire({title:"¿Estás seguro de que deseas eliminar este blog?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await fetch(N(w.endpoints.blogs.delete(t)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}})).ok?(f(z=>z.filter(F=>F.id!==t)),await h.fire("Eliminado","Blog eliminado exitosamente","success")):await h.fire("Error","Error al eliminar el blog","error")}catch(L){console.error("Error al eliminar:",L),await h.fire("Error","Error al conectar con el servidor","error")}},D=t=>{E(t),x(!0)},M=t=>{g(t)},I=()=>{g(null)},T=({blog:t,onClose:i})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.imagenes[0]?.ruta_imagen,alt:t.titulo,className:"w-full h-64 object-cover rounded-t-xl"}),e.jsx("button",{onClick:i,className:"absolute top-4 right-4 bg-white rounded-full p-2 shadow-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-teal-700 mb-2",children:t.titulo}),e.jsx("p",{className:"text-gray-500 mb-4",children:t.created_at?new Date(t.created_at).toLocaleDateString():"Fecha no disponible"}),e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("h3",{className:"text-xl font-semibold text-teal-600 mb-2",children:t.titulo||"Sin título de blog"}),e.jsx("p",{className:"text-gray-700 mb-4",children:t.subtitulo1}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-medium text-teal-600 mb-2",children:t.subtitulo2||"Acerca de este blog"}),e.jsx("p",{className:"text-gray-700",children:t.subtitulo2})]}),t.video_id&&e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-medium text-teal-600 mb-2",children:t.video_titulo||"Video relacionado"}),e.jsx("div",{className:"aspect-w-16 aspect-h-9",children:e.jsx("iframe",{src:`https://www.youtube.com/embed/${t.video_id}`,className:"w-full h-64 rounded-lg",allowFullScreen:!0})})]})]})]})]})}):null;return e.jsxs("div",{className:"bg-gray-50 min-h-screen pb-12 sm:pb-16 md:pb-20 lg:pb-24 xl:pb-28",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-600 to-teal-400 text-white p-8 shadow-md",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Gestión de Blog"}),e.jsx("p",{className:"text-teal-50",children:"Administra todas las publicaciones del blog de tu empresa"})]})}),e.jsx("div",{className:"container mx-auto px-4 -mt-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"text-gray-400"})}),e.jsx("input",{type:"text",className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500",placeholder:"Buscar blogs...",value:u,onChange:t=>C(t.target.value)})]}),e.jsx(V,{onBlogAdded:A,isOpen:S,onClose:()=>{x(!1),E(null)},blogToEdit:d})]}),_?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})}):m.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(t=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx("img",{src:t.imagenes[0]?.ruta_imagen,alt:t.titulo,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-0 right-0 m-2 flex space-x-1",children:[e.jsx("button",{onClick:()=>M(t),className:"p-2 bg-white rounded-full hover:bg-teal-50 text-teal-600 shadow-md",title:"Vista previa",children:e.jsx(O,{size:16})}),e.jsx("button",{className:"p-2 bg-white rounded-full hover:bg-yellow-50 text-yellow-600 shadow-md",title:"Editar",onClick:()=>D(t),children:e.jsx($,{size:16})}),e.jsx("button",{onClick:()=>B(t.id),className:"p-2 bg-white rounded-full hover:bg-red-50 text-red-600 shadow-md",title:"Eliminar",children:e.jsx(R,{size:16})})]})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2 line-clamp-1",children:t.titulo}),e.jsx("p",{className:"text-gray-500 text-sm mb-3 line-clamp-2",children:t.subtitulo2}),e.jsxs("div",{className:"mt-auto pt-4 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["ID: ",t.id]}),e.jsx("span",{className:"px-3 py-1 bg-teal-50 text-teal-600 rounded-full text-xs font-medium",children:"Blog"})]})]})]},t.id))}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No se encontraron blogs"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Intenta con otra búsqueda o crea un nuevo blog."})]}),s.length>0&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx("button",{onClick:()=>b(t=>Math.max(t-1,1)),disabled:n===1,className:"px-3 py-1 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 text-sm",children:"Anterior"}),Array.from({length:Math.min(c,5)},(t,i)=>{let p;return c<=5||n<=3?p=i+1:n>=c-2?p=c-4+i:p=n-2+i,e.jsx("button",{onClick:()=>b(p),className:`px-3 py-1 border rounded-md text-sm ${n===p?"bg-teal-500 text-white border-teal-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:p},i)}),e.jsx("button",{onClick:()=>b(t=>Math.min(t+1,c)),disabled:n===c,className:"px-3 py-1 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 text-sm",children:"Siguiente"})]})]})}),a&&e.jsx(T,{blog:a,onClose:I})]})};export{J as default};
