import{c as a}from"./config.DIeDsa7u.js";window.__detalleProducto=window.__detalleProducto||null;async function f(){const l=document.querySelector("#modal2-form-container"),n=document.querySelector("#modal2-product-img");if(!l||!n)return;const r=l.dataset.productLink||"";let i="/images/popup/default.webp",c="Imagen del producto";if(!window.__detalleProducto&&r)try{const t=await fetch(`${a.apiUrl}/api/v1/productos/link/${r}`);if(t.ok){const e=await t.json();window.__detalleProducto=e.data||e}}catch{}if(window.__detalleProducto){const t=window.__detalleProducto,e=t.producto_imagenes?.find(p=>p.tipo==="popup");e?.url_imagen?(i=`${a.apiUrl}${e.url_imagen}`,c=e.texto_alt_SEO||t.nombre):t.imagenes?.length>0&&(i=`${a.apiUrl}${t.imagenes[0].url_imagen}`,c=t.imagenes[0].texto_alt_SEO||t.nombre)}n.src=i,n.alt=c}const s=document.getElementById("modal-detalles-2"),m=document.getElementById("close-modal-detalles-2");m&&(m.onclick=()=>s?.classList.add("hidden"));const g=new MutationObserver(async()=>{s.classList.contains("hidden")||await f()});g.observe(s,{attributes:!0,attributeFilter:["class"]});const d=document.getElementById("form-cotizacion-producto-2"),u=document.getElementById("modal2-form-container"),o=document.getElementById("modal2-cotizacion-mensaje");d&&u&&d.addEventListener("submit",async l=>{l.preventDefault();const n=new FormData(d),r=n.get("nombre"),i="+51 "+n.get("telefono"),c=n.get("correo"),t=u.dataset.productLink;try{await fetch(`${a.apiUrl}${a.endpoints.whatsapp.info}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:t,phone:i,email:c??null})}),o&&(o.textContent="WhatsApp enviado ✅")}catch{o&&(o.textContent="WhatsApp falló ❌")}try{const e=await fetch(`${a.apiUrl}${a.endpoints.email.sendEmailByProductLink}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,celular:i,email:c,link:t})});o&&(o.textContent+=e.ok?" | Correo enviado ✅":" | Correo falló ❌")}catch{o&&(o.textContent+=" | Correo falló ❌")}d.reset()});
