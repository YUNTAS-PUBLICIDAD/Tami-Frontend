import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.DtoOFyvK.js";import{g as B,c as G}from"./config.BBxWIZNq.js";const Y={src:"/_astro/Diseno.DgDj0L81.webp"},q={src:"/_astro/logo-blanco-tami.BqjAaMyp.gif"},S="catalogModalLastClosed",y=180*1e3,h="catalogModalSessionShown",P=()=>{const[s,R]=o.useState(""),[l,f]=o.useState(!1),[c,E]=o.useState(!1),[g,j]=o.useState(""),[p,I]=o.useState(""),[w,N]=o.useState(""),[u,d]=o.useState({}),[M,A]=o.useState(!1),[O,U]=o.useState(""),C=o.useRef(0),v=o.useRef(!1),m=o.useRef(!1),x=["/","/about","/productos","/politicas-de-envio","/blog"];o.useEffect(()=>{typeof window<"u"&&R(window.location.pathname)},[]),o.useEffect(()=>{if(!s||!x.includes(s)||l||c)return;let e=null;const n=parseInt(localStorage.getItem(S)||"0",10),i=Date.now(),r=sessionStorage.getItem(h),a=document.querySelector(".modal-overlay"),b=document.getElementById("catalog-modal");return i-n>=y&&!m.current&&!r&&!a&&!b&&!l&&(e=setTimeout(()=>{f(!0),m.current=!0,sessionStorage.setItem(h,"true")},16e3)),()=>{e&&clearTimeout(e)}},[s,l,c]),o.useEffect(()=>{if(!s||!x.includes(s))return;const e=n=>{if(n.clientY<=0){if(l||c)return;const i=parseInt(localStorage.getItem(S)||"0",10),r=Date.now(),a=sessionStorage.getItem(h),b=document.querySelector(".modal-overlay"),k=document.getElementById("catalog-modal");r-i>=y&&!m.current&&!a&&!b&&!k&&!l&&(f(!0),m.current=!0,sessionStorage.setItem(h,"true"))}};return window.addEventListener("mouseout",e),()=>window.removeEventListener("mouseout",e)},[s,l,c]),o.useEffect(()=>{const e=()=>{if(!s||!x.includes(s))return;document.querySelector(".modal-overlay")||f(!0)};return window.addEventListener("open-scroll-modal",e),()=>window.removeEventListener("open-scroll-modal",e)},[s]),o.useEffect(()=>{const e=()=>{if(!s||!x.includes(s)||l||c)return;const n=window.scrollY,i=n<C.current?"up":"down";if(C.current=n,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(v.current=!0),v.current&&i==="up"&&!m.current){const a=parseInt(localStorage.getItem(S)||"0",10);if(Date.now()-a<y)return;f(!0),m.current=!0,v.current=!1}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[s,l,c]);const L=()=>{j(""),I(""),N(""),d({})},D=()=>{E(!0),setTimeout(()=>{f(!1),E(!1),L(),localStorage.setItem(S,Date.now().toString()),sessionStorage.removeItem(h),m.current=!1},300)},T=()=>{const e={};return(g.trim().length<3||g.trim().length>75)&&(e.nombre="El nombre debe tener entre 3 y 75 caracteres."),/^\d{7,15}$/.test(p.trim())||(e.telefono="El teléfono debe tener entre 7 y 15 dígitos numéricos."),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w.trim())||(e.correo="El correo no es válido."),d(e),Object.keys(e).length===0},_=async e=>{if(e.preventDefault(),!!T()){A(!0);try{const n=new FormData;n.append("name",g),n.append("email",w),n.append("celular",p);const i=await fetch(B(G.endpoints.clientes.create),{method:"POST",body:n});if(!i.ok){const r=await i.json().catch(()=>null);if(console.error("[ScrollModal] Error al enviar:",r),r?.errors){const a={};r.errors.name&&(a.nombre=r.errors.name.join(" ")),r.errors.celular&&(a.telefono=r.errors.celular.join(" ")),r.errors.email&&(a.correo=r.errors.email.join(" ")),d(a)}else d({general:"No se pudo enviar la información. Intenta nuevamente."});return}console.log("[ScrollModal] Enviado exitosamente:",{nombre:g,telefono:p,correo:w}),d({general:"✅ Información enviada con éxito ✅"}),setTimeout(()=>{D(),d({})},1500)}catch(n){console.error("[ScrollModal] Error al enviar:",n),d({general:n.message||"Error desconocido."})}finally{A(!1)}}};return!x.includes(s)||!l?null:t.jsx("div",{id:"catalog-modal",className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center px-4 modal-overlay transition-opacity duration-500 animate-fadeIn",children:t.jsxs("div",{className:`bg-white flex flex-col sm:flex-row overflow-hidden shadow-2xl w-[90%] max-w-md sm:max-w-3xl relative rounded-3xl border border-teal-400 transition-all duration-500 ${c?"animate-slideOut":"animate-slideIn"}`,children:[t.jsxs("div",{className:"hidden sm:block w-2/4 relative animate-fadeInLeft",children:[t.jsx("img",{src:Y.src,alt:"Asesoría",title:"Asesoría",className:"w-full h-full object-cover select-none scale-105 transition-transform duration-700"}),t.jsx("img",{src:q.src,alt:"LogoTami",title:"Logo Tami",className:"absolute top-40 left-4 w-80 h-80 object-contain select-none drop-shadow-2xl animate-fadeIn"})]}),t.jsx("div",{className:"w-full sm:w-3/5 bg-gradient-to-b from-[#01A09E] to-[#00D6D3] text-white relative animate-fadeInRight",children:t.jsxs("div",{className:"py-6 sm:py-10 mx-2 sm:mx-8 min-h-[420px]",children:[t.jsx("button",{onClick:D,"aria-label":"Cerrar modal",className:"absolute top-4 right-5 text-md text-white hover:text-gray-300 transition-colors duration-300 cursor-pointer",children:"X"}),t.jsxs("h2",{className:"scrollmodal-body select-none text-2xl sm:text-3xl font-extrabold mb-6 animate-fadeInUp",children:["DESCARGA"," ",t.jsx("span",{className:"scrollmodal-title text-yellow-200",children:"GRATIS"})," ","NUESTRO"," ",t.jsx("span",{className:"scrollmodal-title text-yellow-200",children:"CATÁLOGO"})]}),t.jsxs("form",{onSubmit:_,className:"flex flex-col gap-1 animate-fadeInUp",children:[t.jsx("h3",{className:"text-base sm:text-lg font-bold select-none",children:"Nombre"}),t.jsx("input",{type:"text",placeholder:"Nombres y Apellidos",value:g,onChange:e=>j(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1 focus:ring-2 focus:ring-teal-400 transition-all duration-300"}),t.jsx("p",{className:"text-sm text-yellow-100 mb-3 h-5 transition-opacity duration-300",children:u.nombre||" "}),t.jsx("h3",{className:"text-base sm:text-lg font-bold select-none",children:"Teléfono"}),t.jsx("input",{type:"tel",placeholder:"Teléfono: 905 876 524",value:p,onChange:e=>I(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1 focus:ring-2 focus:ring-teal-400 transition-all duration-300"}),t.jsx("p",{className:"text-sm text-yellow-100 mb-3 h-5 transition-opacity duration-300",children:u.telefono||" "}),t.jsx("h3",{className:"text-base sm:text-lg font-bold select-none",children:"Correo"}),t.jsx("input",{type:"email",placeholder:"Correo@gmail.com",value:w,onChange:e=>N(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1 focus:ring-2 focus:ring-teal-400 transition-all duration-300"}),t.jsx("p",{className:`text-sm text-center mb-3 h-5 transition-opacity duration-300 ${u.correo||u.general?"text-red-100":O?"text-green-100":"text-yellow-100"}`,children:u.correo||u.general||O||" "}),t.jsx("button",{type:"submit",disabled:M,className:"bg-[#01A09E] rounded-2xl text-white w-full sm:max-w-fit p-3 sm:p-4 text-xl sm:text-3xl font-bold mx-auto shadow-[0_4px_10px_rgba(255,255,255,0.6)] transition-all duration-300 hover:bg-teal-700 hover:scale-105 active:scale-95",children:M?"Enviando...":"¡REGISTRARME!"})]})]})})]})})};export{P as default};
