import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.DtoOFyvK.js";import{g as R,c as A}from"./config.BD8tWXmp.js";const I={src:"/_astro/Diseno.DU0-QbTs.webp"},L={src:"/_astro/logo-blanco-tami.BqjAaMyp.gif"},N="asesoriaModalLastClosed",T=300*1e3,H=()=>{const[y,x]=o.useState(!1),[M,g]=o.useState(!1),[c,h]=o.useState(""),[i,b]=o.useState(""),[m,w]=o.useState(""),[l,n]=o.useState({}),[p,v]=o.useState(!1),[S,k]=o.useState(""),j=o.useRef(0),f=o.useRef(!1),d=o.useRef(!1),C=()=>{h(""),b(""),w(""),n({})};o.useEffect(()=>{const t=()=>{x(!0),d.current=!0};return window.addEventListener("open-scroll-modal",t),()=>window.removeEventListener("open-scroll-modal",t)},[]),o.useEffect(()=>{const t=()=>{const s=window.scrollY,u=s<j.current?"up":"down";if(j.current=s,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(f.current=!0),f.current&&u==="up"&&!d.current){const a=parseInt(localStorage.getItem(N)||"0",10);if(Date.now()-a<T)return;x(!0),d.current=!0,f.current=!1}};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const E=()=>{g(!0),setTimeout(()=>{x(!1),g(!1),C(),localStorage.setItem(N,Date.now().toString()),d.current=!1},300)},D=()=>{const t={};return(c.trim().length<3||c.trim().length>75)&&(t.nombre="El nombre debe tener entre 3 y 75 caracteres."),/^\d{7,15}$/.test(i.trim())||(t.telefono="El teléfono debe tener entre 7 y 15 dígitos numéricos."),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.trim())||(t.correo="El correo no es válido."),n(t),Object.keys(t).length===0},O=async t=>{if(t.preventDefault(),!!D()){v(!0);try{const s=new FormData;s.append("name",c),s.append("email",m),s.append("celular",i);const u=await fetch(R(A.endpoints.clientes.create),{method:"POST",body:s});if(!u.ok){const r=await u.json().catch(()=>null);if(console.error("[ScrollModal] Error al enviar:",r),r?.errors){const a={};r.errors.name&&(a.nombre=r.errors.name.join(" ")),r.errors.celular&&(a.telefono=r.errors.celular.join(" ")),r.errors.email&&(a.correo=r.errors.email.join(" ")),n(a)}else n({general:"No se pudo enviar la información. Intenta nuevamente."});return}console.log("[ScrollModal] Enviado exitosamente:",{nombre:c,telefono:i,correo:m}),n({general:"✅ Información enviada con éxito ✅"}),setTimeout(()=>{E(),n({})},1500)}catch(s){console.error("[ScrollModal] Error al enviar:",s),n({general:s.message||"Error desconocido."})}finally{v(!1)}}};return y?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center px-4 modal-overlay",children:e.jsxs("div",{className:`bg-white flex flex-col sm:flex-row overflow-hidden shadow-lg w-[90%] max-w-md sm:max-w-3xl relative ${M?"animate-slideOut":"animate-slideIn"}`,children:[e.jsxs("div",{className:"hidden sm:block w-2/5 relative",children:[e.jsx("img",{src:I.src,alt:"Asesoría",className:"w-full h-full object-cover"}),e.jsx("img",{src:L.src,alt:"LogoTami",className:"absolute top-4 left-4 w-10 h-12"})]}),e.jsx("div",{className:"w-full sm:w-3/5 bg-gradient-to-b from-orange-300 to-teal-600 p-6 text-white relative",children:e.jsxs("div",{className:"py-6 sm:py-10 mx-2 sm:mx-8 min-h-[420px]",children:[e.jsx("button",{onClick:E,"aria-label":"Cerrar modal",className:"absolute top-4 right-5 text-md text-white hover:text-gray-300",children:"X"}),e.jsx("h2",{className:"text-xl sm:text-3xl font-bold text-center sm:mt-3 mb-4",children:"¡RECIBE UNA ASESORÍA GRATIS!"}),e.jsxs("form",{onSubmit:O,className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Nombre"}),e.jsx("input",{type:"text",value:c,onChange:t=>h(t.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1"}),e.jsx("p",{className:"text-sm text-yellow-100 mb-3 h-5",children:l.nombre||" "}),e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Teléfono"}),e.jsx("input",{type:"tel",value:i,onChange:t=>b(t.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1"}),e.jsx("p",{className:"text-sm text-yellow-100 mb-3 h-5",children:l.telefono||" "}),e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Correo"}),e.jsx("input",{type:"email",value:m,onChange:t=>w(t.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1"}),e.jsx("p",{className:`text-sm text-center mb-3 h-5 ${l.correo||l.general?"text-red-100":S?"text-green-100":"text-yellow-100"}`,children:l.correo||l.general||S||" "}),e.jsx("button",{type:"submit",disabled:p,className:"bg-orange-300 hover:bg-orange-400 text-white w-full sm:max-w-fit p-3 sm:p-4 text-xl sm:text-3xl font-bold rounded-xl mx-auto text-center",children:p?"Enviando...":"¡HABLEMOS!"})]})]})})]})}):null};export{H as default};
