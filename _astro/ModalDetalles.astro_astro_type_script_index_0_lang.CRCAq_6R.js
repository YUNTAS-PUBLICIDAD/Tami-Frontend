import{c}from"./config.BBxWIZNq.js";const g={NEGOCIOS:{gradient:"from-sky-400 to-sky-600",title:"DESCARGA MÁS INFORMACIÓN GRATIS",btn:"bg-sky-400 hover:bg-sky-500 cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"},MAQUINARIA:{gradient:"from-emerald-400 to-teal-600",title:"DESCARGA TU <span class='scrollmodal-title'>GUÍA TÉCNICA GRATIS</span>",btn:"bg-emerald-400 hover:bg-emerald-500 cursor-pointer",buttonText:"¡SÍ, QUIERO MI GUÍA!"},DECORACIÓN:{gradient:"from-violet-500 to-indigo-700",title:"TU GUÍA DE DECORACIÓN EXCLUSIVA, GRATIS",btn:"bg-violet-500 hover:bg-violet-600 cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"}},i={"soldadora-lingba":"/images/popup/soldadora-lingba.webp","purificador-de-agua":"/images/popup/purificador-de-agua.webp","maquina-de-embalaje-de-te":"/images/popup/maquina-de-embalaje-de-te.webp","maquina-selladora-de-bolsas-para-solidos":"/images/popup/maquina-selladora-de-bolsas-para-solidos.webp","mesa-led-bar-alta-cuadrada":"/images/popup/mesa-led-bar-alta-cuadrada.webp","mesa-led-bar-alta":"/images/popup/mesa-led-bar-alta.webp","selladora-por-induccion":"/images/popup/selladora-por-induccion.webp","selladora-de-vaso-manual":"/images/popup/selladora-de-vaso-manual.webp","silla-bar-led-alta":"/images/popup/silla-bar-led-alta.webp","sillas-cuadradas-o-de-cubo":"/images/popup/sillas-cuadradas-o-de-cubo.webp","soldadora-spark-mig-250":"/images/popup/soldadora-spark-mig-250.webp","ventilador-holografico":"/images/popup/ventilador-holografico.webp","maquina-selladora-de-bolsas-para-liquidos":"/images/popup/maquina-selladora-de-bolsas-para-liquidos.webp",default:"/images/popup/default.webp"},f=document.getElementById("modal-form-container");f?.dataset.whatsapp;let m=g.NEGOCIOS;const w="asesoriaModalLastClosedDetalle",O=180*1e3;let b=!1,C=!1;function I(){y(),E();const e=document.getElementById("modal-cotizacion-producto"),o=document.getElementById("modal-cotizacion-mensaje");e&&o&&(e.classList.remove("hidden"),o.textContent="",b=!0)}function E(){const e=document.getElementById("modal-form-container"),o=document.getElementById("modal-product-img");if(!e||!o)return;const a=e.dataset.productLink||"";console.log("Link del producto desde dataset:",a);let t=i.default,s="Imagen por defecto";if(window.__detalleProducto){const p=window.__detalleProducto,l=p.producto_imagenes?.find(r=>r.tipo==="popup");l?.url_imagen?(t=`${c.apiUrl}${l.url_imagen}`,s=l.texto_alt_SEO||p.nombre||"Imagen del producto",console.log("Imagen popup encontrada desde API:",t)):(t=i[a]||i.default,s=`Imagen para ${a}`,console.log("Usando imagen hardcodeada o default:",t))}else t=i[a]||i.default,s=`Imagen para ${a}`,console.log("Producto no cargado, usando imagen hardcodeada:",t);const d=new Image;d.onload=function(){o.src=t,o.alt=s},d.onerror=function(){console.error("Error al cargar la imagen:",t),o.src=i.default,o.alt="Imagen por defecto"},d.src=t}function S(){const e=parseInt(localStorage.getItem(w)||"0",10);return Date.now()-e>=O}const v=document.getElementById("close-modal-cotizacion");v&&(v.onclick=()=>{const e=document.getElementById("modal-cotizacion-producto");e&&e.classList.add("hidden"),localStorage.setItem(w,Date.now().toString()),b=!1});const u=document.getElementById("form-cotizacion-producto");u&&(u.onsubmit=async e=>{e.preventDefault();const o=new FormData(u),a=o.get("nombre"),t="+51 "+o.get("telefono"),s=o.get("correo"),d=document.getElementById("modal-form-container")?.dataset.productLink,p=`Hola, me llamo ${a}. Teléfono: ${t}, Correo: ${s}. Me interesa recibir asesoría.`;try{const r=await fetch(`${c.apiUrl}${c.endpoints.whatsapp.sendMessageAccept}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telefono:t,comentario:p})});if(r.ok){const n=await r.json();console.log("Mensaje enviado con éxito:",n)}else{const n=await r.json();console.error("Error al enviar mensaje:",n)}}catch(r){console.error("Error al enviar mensaje a WhatsApp:",r)}const l=document.getElementById("modal-cotizacion-mensaje");l&&(l.textContent="Enviado a WhatsApp ✅");try{if((await fetch(`${c.apiUrl}${c.endpoints.email.sendEmailByProductLink}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,celular:t,email:s,link:d})})).ok){const n=document.getElementById("modal-cotizacion-mensaje");n&&(n.textContent="Correo enviado con éxito ✅")}else{const n=document.getElementById("modal-cotizacion-mensaje");n&&(n.textContent="Error al enviar el correo. Intenta nuevamente.")}}catch(r){console.error("Error al enviar el formulario:",r);const n=document.getElementById("modal-cotizacion-mensaje");n&&(n.textContent="Error al enviar el correo. Intenta nuevamente.")}u.reset()});function y(){const e=document.getElementById("modal-form-container"),o=document.getElementById("modal-title"),a=document.getElementById("modal-submit-btn"),t=document.getElementById("modal-submit-btn");e&&(e.classList.remove("from-sky-400","to-sky-600","from-emerald-400","to-teal-600","from-violet-500","to-indigo-700"),e.classList.add("bg-gradient-to-b",...m.gradient.split(" "))),o&&(o.innerHTML=m.title),a&&(a.classList.remove("bg-sky-400","hover:bg-sky-500","bg-emerald-400","hover:bg-emerald-500","bg-violet-500","hover:bg-violet-600"),a.classList.add(...m.btn.split(" "),"text-white")),t&&(t.textContent=m.buttonText||"Enviar",t.classList.add("font-bold"))}function h(){document.querySelectorAll('[id^="btnQuotation"]').forEach(o=>{o.addEventListener("click",()=>{I()})})}window.addEventListener("open-scroll-modal",I);window.addEventListener("scroll",()=>{window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100>30&&!C&&S()&&!b&&(C=!0,I())});function A(){const e=document.getElementById("modal-form-container");if(!e)return;const a=(e.dataset.seccion||"NEGOCIOS").normalize?.("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase(),s={NEGOCIOS:"NEGOCIOS",MAQUINARIA:"MAQUINARIA",DECORACION:"DECORACIÓN"}[a]||"NEGOCIOS";m=g[s]||g.NEGOCIOS,y()}f&&new MutationObserver(o=>{o.forEach(a=>{a.attributeName==="data-seccion"&&A(),a.attributeName==="data-product-link"&&E()})}).observe(f,{attributes:!0,attributeFilter:["data-seccion","data-product-link"]});document.addEventListener("DOMContentLoaded",function(){localStorage.removeItem("asesoriaModalLastClosedDetalle"),A(),E(),h()});
