import{c as n}from"./config.DIeDsa7u.js";window.__detalleProducto=window.__detalleProducto||null;async function g(){const c=document.querySelector("#modal3-form-container"),e=document.querySelector("#modal3-product-img");if(!c||!e)return;const i=c.dataset.productLink||"";let l="/images/popup/default.webp",r="Imagen del producto",u="fondo";if(!window.__detalleProducto&&i)try{const t=await fetch(`${n.apiUrl}/api/v1/productos/link/${i}`);if(t.ok){const a=await t.json();window.__detalleProducto=a.data||a}}catch{}if(window.__detalleProducto){const t=window.__detalleProducto,a=t.producto_imagenes?.find(f=>f.tipo==="popup");a?.url_imagen?(l=`${n.apiUrl}${a.url_imagen}`,r=a.texto_alt_SEO||t.nombre):t.imagenes?.length>0&&(l=`${n.apiUrl}${t.imagenes[0].url_imagen}`,r=t.imagenes[0].texto_alt_SEO||t.nombre),t.etiqueta?.popup_estilo==="estilo3"&&(u=t.etiqueta.popup3_sin_fondo?"recorte":"fondo")}e.src=l,e.alt=r,e.classList.remove("absolute","inset-0","w-full","h-full","object-cover"),e.classList.remove("max-h-[85%]","max-w-[85%]","object-contain"),u==="recorte"?e.classList.add("max-h-[85%]","max-w-[85%]","object-contain"):e.classList.add("absolute","inset-0","w-full","h-full","object-cover")}const m=document.getElementById("modal-detalles-3"),p=document.getElementById("close-modal-detalles-3");p&&(p.onclick=()=>m?.classList.add("hidden"));const w=new MutationObserver(async()=>{m.classList.contains("hidden")||await g()});w.observe(m,{attributes:!0,attributeFilter:["class"]});const s=document.getElementById("form-cotizacion-producto-3"),d=document.getElementById("modal3-form-container"),o=document.getElementById("modal3-mensaje");s&&d&&s.addEventListener("submit",async c=>{c.preventDefault();const e=new FormData(s),i="+51 "+e.get("telefono");try{await fetch(`${n.apiUrl}${n.endpoints.whatsapp.info}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:d.dataset.productLink,phone:i,email:e.get("correo")??null})}),o&&(o.textContent="WhatsApp enviado ✅")}catch{o&&(o.textContent="WhatsApp falló ❌")}try{const l=await fetch(`${n.apiUrl}${n.endpoints.email.sendEmailByProductLink}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.get("nombre"),celular:i,email:e.get("correo"),link:d.dataset.productLink})});o&&(o.textContent+=l.ok?" | Correo enviado ✅":" | Correo falló ❌")}catch{o&&(o.textContent+=" | Correo falló ❌")}s.reset()});
