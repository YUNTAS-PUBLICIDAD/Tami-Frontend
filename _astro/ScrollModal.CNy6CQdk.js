import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.DYrVU9rO.js";import{g as _,c as B}from"./config.DIeDsa7u.js";const G={src:"/_astro/Diseno.DgDj0L81.webp"},Y={src:"/_astro/logo-blanco-tami.BqjAaMyp.gif"},x="catalogModalLastClosed",y=180*1e3,w="catalogModalSessionShown",H=()=>{const[n,O]=s.useState(""),[a,g]=s.useState(!1),[i,j]=s.useState(!1),[p,E]=s.useState(""),[v,N]=s.useState(""),[b,I]=s.useState(""),[f,c]=s.useState({}),[M,R]=s.useState(!1),[A,$]=s.useState(""),C=s.useRef(0),S=s.useRef(!1),d=s.useRef(!1),h=["/","/sobre-nosotros","/productos","/politicas-de-envio","/blog"];s.useEffect(()=>{typeof window<"u"&&O(window.location.pathname)},[]),s.useEffect(()=>{if(!n||!h.includes(n)||a||i)return;let e=null;const o=parseInt(localStorage.getItem(x)||"0",10),u=Date.now(),m=sessionStorage.getItem(w),r=document.querySelector(".modal-overlay"),l=document.getElementById("catalog-modal");return u-o>=y&&!d.current&&!m&&!r&&!l&&!a&&(e=setTimeout(()=>{g(!0),d.current=!0,sessionStorage.setItem(w,"true")},5e3)),()=>{e&&clearTimeout(e)}},[n,a,i]),s.useEffect(()=>{if(!n||!h.includes(n))return;const e=o=>{if(o.clientY<=0){if(a||i)return;const u=parseInt(localStorage.getItem(x)||"0",10),m=Date.now(),r=sessionStorage.getItem(w),l=document.querySelector(".modal-overlay");m-u>=y&&!d.current&&!r&&!l&&!a&&(g(!0),d.current=!0,sessionStorage.setItem(w,"true"))}};return window.addEventListener("mouseout",e),()=>window.removeEventListener("mouseout",e)},[n,a,i]),s.useEffect(()=>{const e=()=>{!n||!h.includes(n)||document.querySelector(".modal-overlay")||g(!0)};return window.addEventListener("open-scroll-modal",e),()=>window.removeEventListener("open-scroll-modal",e)},[n]),s.useEffect(()=>{const e=()=>{if(!n||!h.includes(n)||a||i)return;const o=window.scrollY,u=o<C.current?"up":"down";if(C.current=o,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(S.current=!0),S.current&&u==="up"&&!d.current){const r=parseInt(localStorage.getItem(x)||"0",10);if(Date.now()-r<y)return;g(!0),d.current=!0,S.current=!1}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[n,a,i]);const D=()=>{E(""),N(""),I(""),c({})},L=()=>{j(!0),setTimeout(()=>{g(!1),j(!1),D(),localStorage.setItem(x,Date.now().toString()),sessionStorage.removeItem(w),d.current=!1},300)},T=()=>{const e={};return(p.trim().length<3||p.trim().length>75)&&(e.nombre="El nombre debe tener entre 3 y 75 caracteres."),/^9\d{8}$/.test(v)||(e.telefono="El celular debe tener 9 dígitos (Ej: 987654321)"),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b.trim())||(e.correo="El correo no es válido."),c(e),Object.keys(e).length===0},k=async e=>{if(e.preventDefault(),!!T()){R(!0);try{const o=new FormData;o.append("name",p),o.append("email",b);const u=`+51${v}`;o.append("celular",u);const m=await fetch(_(B.endpoints.clientes.create),{method:"POST",body:o});if(!m.ok){const r=await m.json().catch(()=>null);if(console.error("[ScrollModal] Error al enviar:",r),r?.errors){const l={};r.errors.name&&(l.nombre=r.errors.name.join(" ")),r.errors.celular&&(l.telefono=r.errors.celular.join(" ")),r.errors.email&&(l.correo=r.errors.email.join(" ")),c(l)}else c({general:"No se pudo enviar la información. Intenta nuevamente."});return}c({general:"✅ Información enviada con éxito ✅"}),setTimeout(()=>{L(),c({})},1500)}catch(o){console.error("[ScrollModal] Error al enviar:",o),c({general:o.message||"Error desconocido."})}finally{R(!1)}}};return!h.includes(n)||!a?null:t.jsx("div",{id:"catalog-modal",className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center px-4 modal-overlay transition-opacity duration-500 animate-fadeIn",children:t.jsxs("div",{className:`flex flex-col sm:flex-row overflow-hidden shadow-2xl w-[90%] max-w-md sm:max-w-3xl relative rounded-xl transition-all duration-500 h-[480px] ${i?"animate-slideOut":"animate-slideIn"}`,children:[t.jsx("div",{className:"absolute inset-0 sm:flex w-[80%] justify-center items-center bg-gray-100 overflow-hidden",children:t.jsx("img",{src:G.src,alt:"Asesoría",className:"w-full h-full object-cover select-none scale-105 transition-transform duration-700"})}),t.jsx("div",{className:"absolute inset-0 ",style:{background:"linear-gradient(to left, #00786F 0%, #018C86 45%, rgba(1, 160, 158, 0.6) 100%)"}}),t.jsx("div",{className:"hidden sm:flex sm:w-6/12 justify-center items-center relative z-10",children:t.jsx("img",{src:Y.src,alt:"LogoTami",className:"w-60 h-60 object-contain select-none drop-shadow-2xl animate-fadeIn z-20"})}),t.jsx("div",{className:"w-full sm:w-6/12 text-white relative animate-fadeInRight h-full",children:t.jsxs("div",{className:"sm:py-10 p-10 sm:px-8 h-full space-y-10",children:[t.jsx("button",{onClick:L,className:"absolute top-3 right-3 sm:top-4 sm:right-4 bg-white text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded-full w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center shadow-lg transition-all duration-300 z-50 cursor-pointer hover:scale-110","aria-label":"Cerrar modal",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),t.jsxs("h2",{className:"scrollmodal-body select-none font-semibold animate-fadeInUp",children:["DESCARGA ",t.jsx("span",{className:"scrollmodal-title text-yellow-200",children:"GRATIS"})," NUESTRO ",t.jsx("span",{className:"scrollmodal-title text-yellow-200",children:"CATÁLOGO"})]}),t.jsxs("form",{onSubmit:k,className:"flex flex-col gap-1 animate-fadeInUp",children:[t.jsx("input",{type:"text",placeholder:"Nombres y Apellidos",value:p,onChange:e=>E(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1 focus:ring-2 focus:ring-teal-400 transition-all duration-300"}),t.jsx("p",{className:"text-sm text-yellow-100 min-h-[20px]",children:f.nombre}),t.jsx("input",{type:"tel",placeholder:"Número de celular",maxLength:9,value:v,onChange:e=>{const o=e.target.value.replace(/\D/g,"");N(o)},className:"p-2 rounded-lg bg-white text-black outline-none mb-1 focus:ring-2 focus:ring-teal-400 transition-all duration-300"}),t.jsx("p",{className:"text-sm text-yellow-100 min-h-[20px]",children:f.telefono}),t.jsx("input",{type:"email",placeholder:"Correo electrónico",value:b,onChange:e=>I(e.target.value),className:"p-2 rounded-lg bg-white text-black outline-none mb-1 focus:ring-2 focus:ring-teal-400 transition-all duration-300"}),t.jsx("p",{className:`text-sm text-center min-h-[20px] ${f.correo||f.general?"text-red-100":A?"text-green-100":"text-yellow-100"}`,children:f.correo||f.general||A}),t.jsx("button",{type:"submit",disabled:M,className:"bg-[#01A09E] rounded text-white w-full sm:max-w-fit py-2 px-8 text-lg font-bold mx-auto shadow-[0_4px_10px_rgba(0,0,0,0.3)] transition-all duration-300 hover:bg-teal-700 hover:scale-105 active:scale-95",children:M?"Enviando...":"¡REGISTRARME!"})]})]})})]})})};export{H as default};
