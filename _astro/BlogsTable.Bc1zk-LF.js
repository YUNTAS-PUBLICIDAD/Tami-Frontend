import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.BJfUAbRs.js";import{F as $,e as V,a as R,d as O}from"./index.A096yah2.js";import{g as v,c as N}from"./config.DgE3SQac.js";import{S as f}from"./sweetalert2.esm.all.9Qm2jZ7z.js";const q=({onBlogAdded:L,isOpen:g,onClose:c,blogToEdit:i})=>{const[p,j]=n.useState(!1),[k,h]=n.useState(!1),[P,B]=n.useState([]),[a,d]=n.useState({titulo:"",link:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",producto_id:0,titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]});n.useEffect(()=>{typeof g=="boolean"&&j(g)},[g]),n.useEffect(()=>{i&&d({titulo:i.titulo||"",link:i.link||"",parrafo:i.parrafo||"",descripcion:i.descripcion||"",imagen_principal:null,titulo_blog:i.tituloBlog||"",subtitulo_beneficio:i.subTituloBlog||"",url_video:i.videoBlog||"",producto_id:i.producto_id||0,titulo_video:i.tituloVideoBlog||"",imagenes:[{url_imagen:null,parrafo_imagen:i.parrafoImagenesBlog?.[0]||""},{url_imagen:null,parrafo_imagen:i.parrafoImagenesBlog?.[1]||""}]}),g||d({titulo:"",link:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",producto_id:0,titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]})},[i,g]),n.useEffect(()=>{p&&fetch(v(N.endpoints.blogs.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(r=>r.json()).then(r=>{const l=r?.data?.map(o=>parseInt(o.link)).filter(o=>Number.isInteger(o)&&o>0),s=D(l||[]);d(o=>({...o,link:String(s)}))}).catch(r=>console.error("Error al obtener blogs:",r))},[p]),n.useEffect(()=>{p&&fetch(v(N.endpoints.productos.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(r=>r.json()).then(r=>{B(r||[])}).catch(r=>console.error("Error al obtener productos:",r))},[p]);function D(r){const l=new Set(r);let s=1;for(;l.has(s);)s++;return s}const m=r=>{const{name:l,value:s}=r.target;if(l==="link"){const o=s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replaceAll(" ","-");d(b=>({...b,link:o}))}else d(o=>({...o,[l]:s}))},w=r=>{r.target.files&&r.target.files[0]&&d({...a,imagen_principal:r.target.files[0]})},C=(r,l)=>{if(r.target.files&&r.target.files[0]){const s=[...a.imagenes];s[l]={...s[l],url_imagen:r.target.files[0]},d({...a,imagenes:s})}},E=(r,l)=>{const s=[...a.imagenes];s[l]={...s[l],parrafo_imagen:r.target.value},d({...a,imagenes:s})},y=()=>{j(!1),d({titulo:"",link:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",producto_id:0,titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]})},S=async r=>{if(r.preventDefault(),h(!0),!a.titulo||!a.link||!a.parrafo||!a.descripcion||!a.subtitulo_beneficio||!a.titulo_blog||!a.titulo_video||!a.url_video||!a.producto_id||!a.imagen_principal||!a.imagenes||a.imagenes.some(l=>!l.url_imagen)){f.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."}),h(!1);return}try{const l=localStorage.getItem("token"),s=new FormData;s.append("titulo",a.titulo),s.append("link",a.link),s.append("parrafo",a.parrafo),s.append("descripcion",a.descripcion),s.append("subtitulo_beneficio",a.subtitulo_beneficio),s.append("titulo_blog",a.titulo_blog),s.append("titulo_video",a.titulo_video),s.append("url_video",a.url_video),console.log("Producto ID a enviar:",a.producto_id),a.producto_id?s.append("producto_id",a.producto_id.toString()):console.error("producto_id no está definido o es vacío"),a.imagenes.forEach((_,A)=>{_.url_imagen&&s.append(`imagenes[${A}][imagen]`,_.url_imagen),s.append(`imagenes[${A}][parrafo_imagen]`,_.parrafo_imagen)}),s.append("imagen_principal",a.imagen_principal);let o,b;i&&i.id?o=await fetch(v(N.endpoints.blogs.update(i.id)),{method:"POST",body:s}):o=await fetch(v(N.endpoints.blogs.create),{method:"POST",body:s}),b=await o.json(),console.log("Respuesta del servidor:",b),o.ok?(await f.fire({icon:"success",title:i?"Blog actualizado exitosamente":"Blog añadido exitosamente",showConfirmButton:!0}),c&&c(),j(!1)):f.fire({icon:"error",title:"Error",text:`❌ Error: ${b.message}`})}catch(l){console.error("Error al enviar los datos:",l),f.fire({icon:"error",title:"Error",text:`❌ Error: ${l}`})}finally{h(!1)}L()};return e.jsxs(e.Fragment,{children:[!g&&e.jsx("button",{onClick:()=>j(!0),className:"mt-4 bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105",children:"Añadir Blog"}),(p||g)&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"max-h-[90vh] overflow-y-auto bg-white text-gray-800 p-8 rounded-xl w-full max-w-4xl shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-teal-600",children:i?"Editar Blog":"Añadir Nuevo Blog"}),e.jsx("button",{onClick:c||y,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("form",{encType:"multipart/form-data",onSubmit:S,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título*"}),e.jsx("input",{type:"text",name:"titulo",value:a.titulo,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Link*"}),e.jsx("input",{type:"text",name:"link",value:a.link,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Párrafo*"}),e.jsx("input",{type:"text",name:"parrafo",value:a.parrafo,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción*"}),e.jsx("input",{type:"text",name:"descripcion",value:a.descripcion,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtítulo Beneficio*"}),e.jsx("input",{type:"text",name:"subtitulo_beneficio",value:a.subtitulo_beneficio,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título Blog*"}),e.jsx("input",{type:"text",name:"titulo_blog",value:a.titulo_blog,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título Video*"}),e.jsx("input",{type:"text",name:"titulo_video",value:a.titulo_video,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"URL del Video*"}),e.jsx("input",{type:"text",name:"url_video",value:a.url_video,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Producto*"}),e.jsxs("select",{name:"producto_id",value:a.producto_id,onChange:m,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition",children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),P.map(r=>e.jsx("option",{value:r.id,children:r.nombre},r.id))]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Imagen Principal*"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("label",{className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-teal-500 transition",children:[e.jsx("input",{type:"file",accept:"image/png, image/jpeg, image/jpg",name:"imagen_principal",onChange:w,className:"hidden"}),e.jsx("p",{className:"text-center text-gray-500",children:a.imagen_principal?a.imagen_principal.name:"Seleccionar archivo"})]})})})]}),a.imagenes.map((r,l)=>e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Imagen Adicional ",l+1,"*"]}),e.jsx("div",{className:"flex items-center gap-4 mb-2",children:e.jsx("label",{className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-teal-500 transition",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>C(s,l),className:"hidden"}),e.jsx("p",{className:"text-center text-gray-500",children:r.url_imagen?r.url_imagen.name:"Seleccionar archivo"})]})})}),e.jsx("textarea",{onChange:s=>E(s,l),value:r.parrafo_imagen,placeholder:"Descripción de la imagen...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition min-h-24"})]},l)),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:c||y,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition shadow-md flex items-center justify-center gap-2 min-w-[140px]",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Guardando..."]}):i?"Actualizar Blog":"Guardar Blog"})]})]})]})})]})},J=()=>{const[L,g]=n.useState([]),[c,i]=n.useState(1),[p,j]=n.useState(""),[k,h]=n.useState(!1),[P,B]=n.useState(!0),[a,d]=n.useState(null),[D,m]=n.useState(null),w=6,C=async()=>{B(!0);try{const u=await(await fetch(v(N.endpoints.blogs.list))).json();g(u.data||[])}catch(t){console.error("❌ Error al cargar datos:",t)}finally{B(!1)}};n.useEffect(()=>{C()},[]);const E=()=>{C(),h(!1)},y=L.filter(t=>t.titulo.toLowerCase().includes(p.toLowerCase())||t.descripcion.toLowerCase().includes(p.toLowerCase())),S=c*w,r=S-w,l=y.slice(r,S),s=Math.ceil(y.length/w),o=async t=>{const u=localStorage.getItem("token");if((await f.fire({title:"¿Estás seguro de que deseas eliminar este blog?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await fetch(v(N.endpoints.blogs.delete(t)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}})).ok?(g(z=>z.filter(I=>I.id!==t)),await f.fire("Eliminado","Blog eliminado exitosamente","success")):await f.fire("Error","Error al eliminar el blog","error")}catch(M){console.error("Error al eliminar:",M),await f.fire("Error","Error al conectar con el servidor","error")}},b=t=>{m(t),h(!0)},_=t=>{d(t)},A=()=>{d(null)},F=({blog:t,onClose:u})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.imagenPrincipal,alt:t.titulo,className:"w-full h-64 object-cover rounded-t-xl"}),e.jsx("button",{onClick:u,className:"absolute top-4 right-4 bg-white rounded-full p-2 shadow-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-teal-700 mb-2",children:t.titulo}),e.jsx("p",{className:"text-gray-500 mb-4",children:t.created_at?new Date(t.created_at).toLocaleDateString():"Fecha no disponible"}),e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("h3",{className:"text-xl font-semibold text-teal-600 mb-2",children:t.tituloBlog||"Sin título de blog"}),e.jsx("p",{className:"text-gray-700 mb-4",children:t.parrafo}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-medium text-teal-600 mb-2",children:t.subTituloBlog||"Acerca de este blog"}),e.jsx("p",{className:"text-gray-700",children:t.descripcion})]}),t.videoBlog&&e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-medium text-teal-600 mb-2",children:t.tituloVideoBlog||"Video relacionado"}),e.jsx("div",{className:"aspect-w-16 aspect-h-9",children:e.jsx("iframe",{src:t.videoBlog,className:"w-full h-64 rounded-lg",allowFullScreen:!0})})]})]})]})]})}):null;return e.jsxs("div",{className:"bg-gray-50 min-h-screen pb-12 sm:pb-16 md:pb-20 lg:pb-24 xl:pb-28",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-600 to-teal-400 text-white p-8 shadow-md",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Gestión de Blog"}),e.jsx("p",{className:"text-teal-50",children:"Administra todas las publicaciones del blog de tu empresa"})]})}),e.jsx("div",{className:"container mx-auto px-4 -mt-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"text-gray-400"})}),e.jsx("input",{type:"text",className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500",placeholder:"Buscar blogs...",value:p,onChange:t=>j(t.target.value)})]}),e.jsx(q,{onBlogAdded:E,isOpen:k,onClose:()=>{h(!1),m(null)},blogToEdit:D})]}),P?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})}):l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx("img",{src:t.imagenPrincipal,alt:t.titulo,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-0 right-0 m-2 flex space-x-1",children:[e.jsx("button",{onClick:()=>_(t),className:"p-2 bg-white rounded-full hover:bg-teal-50 text-teal-600 shadow-md",title:"Vista previa",children:e.jsx(V,{size:16})}),e.jsx("button",{className:"p-2 bg-white rounded-full hover:bg-yellow-50 text-yellow-600 shadow-md",title:"Editar",onClick:()=>b(t),children:e.jsx(R,{size:16})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-2 bg-white rounded-full hover:bg-red-50 text-red-600 shadow-md",title:"Eliminar",children:e.jsx(O,{size:16})})]})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2 line-clamp-1",children:t.titulo}),e.jsx("p",{className:"text-gray-500 text-sm mb-3 line-clamp-2",children:t.descripcion}),e.jsxs("div",{className:"mt-auto pt-4 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["ID: ",t.id]}),e.jsx("span",{className:"px-3 py-1 bg-teal-50 text-teal-600 rounded-full text-xs font-medium",children:"Blog"})]})]})]},t.id))}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No se encontraron blogs"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Intenta con otra búsqueda o crea un nuevo blog."})]}),y.length>0&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx("button",{onClick:()=>i(t=>Math.max(t-1,1)),disabled:c===1,className:"px-3 py-1 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 text-sm",children:"Anterior"}),Array.from({length:Math.min(s,5)},(t,u)=>{let x;return s<=5||c<=3?x=u+1:c>=s-2?x=s-4+u:x=c-2+u,e.jsx("button",{onClick:()=>i(x),className:`px-3 py-1 border rounded-md text-sm ${c===x?"bg-teal-500 text-white border-teal-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:x},u)}),e.jsx("button",{onClick:()=>i(t=>Math.min(t+1,s)),disabled:c===s,className:"px-3 py-1 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 text-sm",children:"Siguiente"})]})]})}),a&&e.jsx(F,{blog:a,onClose:A})]})};export{J as default};
