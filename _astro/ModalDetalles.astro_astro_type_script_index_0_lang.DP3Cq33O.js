import{c as s}from"./config.BZJ3FbET.js";const m={NEGOCIOS:{gradient:"custom-gradient-negocio",title:"DESCARGA MÁS INFORMACIÓN GRATIS",btn:"bg-[#14617F] hover:bg-[#1c85ab] cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"},MAQUINARIA:{gradient:"custom-gradient-maquinaria",title:"DESCARGA TU <span class='scrollmodal-title ' style='color:black '>GUÍA TÉCNICA GRATIS</span>",btn:"bg-[#064133] hover:bg-[#096653] cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"},DECORACIÓN:{gradient:"custom-gradient-decoracion",title:"TU GUÍA DE DECORACIÓN EXCLUSIVA, GRATIS",btn:"bg-[#281184] hover:bg-[#3c2eb1] cursor-pointer",buttonText:"¡SÍ, QUIERO CRECER!"}},I="/images/popup/default.webp",u=document.getElementById("modal-form-container");u?.dataset.whatsapp;let d=m.NEGOCIOS;const y="asesoriaModalLastClosedDetalle",A=180*1e3;let g=!1,b=!1;async function p(){w(),await f();const t=document.getElementById("modal-cotizacion-producto"),e=document.getElementById("modal-cotizacion-mensaje");t&&e&&(t.classList.remove("hidden"),e.textContent="",g=!0)}async function f(){const t=document.getElementById("modal-form-container"),e=document.getElementById("modal-product-img");if(!t||!e)return;const o=t.dataset.productLink||"";let a=I,i="Imagen del producto";if(!window.__detalleProducto&&o)try{const n=await fetch(`${s.apiUrl}/api/v1/productos/link/${o}`);if(n.ok){const r=await n.json();window.__detalleProducto=r.data||r}}catch{}if(window.__detalleProducto){const n=window.__detalleProducto,r=n.producto_imagenes?.find(c=>c.tipo==="popup");r?.url_imagen?(a=`${s.apiUrl}${r.url_imagen}`,i=r.texto_alt_SEO||n.nombre||"Imagen del producto"):n.imagenes&&n.imagenes.length>0&&(a=`${s.apiUrl}${n.imagenes[0].url_imagen}`,i=n.imagenes[0].texto_alt_SEO||n.nombre||"Imagen del producto")}e.src=a,e.alt=i,e.onerror=function(){e.src=I,e.alt="Imagen por defecto"}}function S(){const t=parseInt(localStorage.getItem(y)||"0",10);return Date.now()-t>=A}const C=document.getElementById("close-modal-cotizacion");C&&(C.onclick=()=>{const t=document.getElementById("modal-cotizacion-producto");t&&t.classList.add("hidden"),localStorage.setItem(y,Date.now().toString()),g=!1});const l=document.getElementById("form-cotizacion-producto");l&&(l.onsubmit=async t=>{t.preventDefault();const e=new FormData(l),o=e.get("nombre"),a="+51 "+e.get("telefono"),i=e.get("correo"),n=document.getElementById("modal-form-container")?.dataset.productLink,r=`Hola, me llamo ${o}. Teléfono: ${a}, Correo: ${i}. Me interesa recibir asesoría.`,c=document.getElementById("modal-cotizacion-mensaje");try{await fetch(`${s.apiUrl}${s.endpoints.whatsapp.sendMessageAccept}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telefono:a,comentario:r})}),c&&(c.textContent="Enviado a WhatsApp ✅")}catch{}try{(await fetch(`${s.apiUrl}${s.endpoints.email.sendEmailByProductLink}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,celular:a,email:i,link:n})})).ok?c&&(c.textContent="Correo enviado con éxito ✅"):c&&(c.textContent="Error al enviar el correo. Intenta nuevamente.")}catch{c&&(c.textContent="Error al enviar el correo. Intenta nuevamente.")}l.reset()});function w(){const t=document.getElementById("background-modal");document.getElementById("modal-form-container");const e=document.getElementById("modal-title"),o=document.getElementById("modal-submit-btn"),a=document.getElementById("modal-submit-btn");t&&t.classList.add(d.gradient),e&&(e.innerHTML=d.title),o&&(o.classList.remove("bg-sky-400","hover:bg-sky-500","bg-emerald-400","hover:bg-emerald-500","bg-violet-500","hover:bg-violet-600"),o.classList.add(...d.btn.split(" "),"text-white")),a&&(a.textContent=d.buttonText||"Enviar",a.classList.add("font-bold"))}function v(){document.querySelectorAll('[id^="btnQuotation"]').forEach(e=>{e.addEventListener("click",async()=>{await p()})})}window.addEventListener("open-scroll-modal",async()=>{await p()});window.addEventListener("scroll",async()=>{window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100>30&&!b&&S()&&!g&&(b=!0,await p())});function O(){const t=document.getElementById("modal-form-container");if(!t)return;const o=(t.dataset.seccion||"NEGOCIOS").normalize?.("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase(),i={NEGOCIOS:"NEGOCIOS",MAQUINARIA:"MAQUINARIA",DECORACION:"DECORACIÓN"}[o]||"NEGOCIOS";d=m[i]||m.NEGOCIOS,w()}u&&new MutationObserver(e=>{e.forEach(async o=>{o.attributeName==="data-seccion"&&O(),o.attributeName==="data-product-link"&&await f()})}).observe(u,{attributes:!0,attributeFilter:["data-seccion","data-product-link"]});document.addEventListener("DOMContentLoaded",async function(){localStorage.removeItem("asesoriaModalLastClosedDetalle"),O(),await f(),v()});
