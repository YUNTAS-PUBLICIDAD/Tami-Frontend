import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DtoOFyvK.js";import{c as E,g as S,e as M,F as z,a as P,d as B}from"./index.BUtwrFzd.js";import{g as N,c as C}from"./config.WymI9u0k.js";import{S as g}from"./sweetalert2.esm.all.BQIkj5Wb.js";import{P as L}from"./Paginator.DKYp4Ple.js";const T=()=>{const r=()=>{const a=localStorage.getItem("token");if(!a)throw new Error("No se encontró el token");return a};return{addCliente:async a=>{const s=r(),l=N(C.endpoints.clientes.create),o=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(a)});if(!o.ok)throw new Error("Error al agregar cliente");return(await o.json()).data},updateCliente:async(a,s)=>{const l=r(),o=N(C.endpoints.clientes.update(a)),x=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(s)});if(!x.ok)throw new Error("Error al actualizar cliente");return(await x.json()).data},deleteCliente:async a=>{const s=r(),l=N(C.endpoints.clientes.delete(a)),o=await fetch(l,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!o.ok)throw new Error("Error al eliminar cliente");return await o.json()}}},$=(r,d)=>{const[n,m]=i.useState({name:"",celular:"",email:""}),[a,s]=i.useState(!1),{addCliente:l,updateCliente:o}=T();i.useEffect(()=>{r?(m({name:r.name,celular:r.celular,email:r.email}),s(!0)):(y(),s(!1))},[r]);const x=c=>{m({...n,[c.target.name]:c.target.value})},h=async c=>{c.preventDefault();const{name:b,celular:u,email:p}=n;if(!b.trim()||!u.trim()||!p.trim()){await g.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."});return}if(!/^\d+$/.test(u)){await g.fire({icon:"warning",title:"Teléfono inválido",text:"⚠️ El teléfono solo debe contener números."});return}try{a?(await o(r.id,{name:b,celular:u,email:p}),await g.fire({icon:"success",title:"Cliente actualizado",text:"✅ Cliente actualizado correctamente"})):(await l({name:b,celular:u,email:p}),await g.fire({icon:"success",title:"Cliente registrado",text:"✅ Cliente registrado exitosamente"})),d?.(),y()}catch(j){console.error("❌ Error en la operación:",j),await g.fire({icon:"error",title:"Error",text:`❌ Error: ${j.message||"Error desconocido"}`})}},y=()=>{m({name:"",celular:"",email:""}),s(!1)};return{formData:n,handleChange:x,handleSubmit:h}},R=({isOpen:r,setIsOpen:d,cliente:n,onRefetch:m})=>{const{formData:a,handleChange:s,handleSubmit:l}=$(n,()=>{m(),d(!1)});return r?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl px-6 sm:px-8 py-8 sm:py-10 animate-scaleIn",children:[e.jsx("h2",{className:"text-2xl font-bold text-teal-600 mb-6 text-center",children:n?"Editar Cliente":"Añadir Cliente"}),e.jsxs("form",{onSubmit:l,className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",className:"text-sm font-medium text-teal-700 mb-1",children:"Nombres"}),e.jsx("input",{id:"name",name:"name",type:"text",value:a.name,onChange:s,required:!0,className:"p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-900 placeholder:text-gray-400",placeholder:"Ej. Juan Pérez"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"celular",className:"text-sm font-medium text-teal-700 mb-1",children:"Teléfono"}),e.jsx("input",{id:"celular",name:"celular",type:"text",value:a.celular,onChange:s,required:!0,className:"p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-900 placeholder:text-gray-400",placeholder:"Ej. 987654321"})]}),e.jsxs("div",{className:"flex flex-col sm:col-span-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-teal-700 mb-1",children:"Gmail"}),e.jsx("input",{id:"email",name:"email",type:"email",value:a.email,onChange:s,required:!0,className:"p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-900 placeholder:text-gray-400",placeholder:"Ej. cliente@gmail.com"})]}),e.jsxs("div",{className:"sm:col-span-2 flex flex-col sm:flex-row justify-end items-center gap-3 mt-4",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto bg-teal-600 text-white px-5 py-2 rounded-lg hover:bg-teal-700 transition shadow",children:n?"Guardar Cambios":"Añadir Cliente"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"w-full sm:w-auto bg-gray-100 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-200 transition",children:"Cancelar"})]})]})]})}):null},q=({isOpen:r,setIsOpen:d,clienteId:n,onRefetch:m})=>{const{deleteCliente:a}=T(),s=async()=>{if((await g.fire({title:"¿Eliminar cliente?",text:"Esta acción es permanente y no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await a(n),g.fire("Eliminado","El cliente ha sido eliminado exitosamente.","success"),m()}catch(o){console.error("Error al eliminar cliente:",o),g.fire("Error","No se pudo eliminar el cliente.","error")}d(!1)};return r&&s(),null},G=(r,d=1)=>{const[n,m]=i.useState([]),[a,s]=i.useState(1),[l,o]=i.useState(!0),[x,h]=i.useState(null);return i.useEffect(()=>{(async()=>{o(!0),h(null);try{const c=localStorage.getItem("token");if(!c)throw new Error("No se encontró el token de autenticación");const b=`${N(C.endpoints.clientes.list)}?page=${d}`;console.log(b);const u=await fetch(b,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}});if(!u.ok)throw new Error(`Error al obtener clientes: ${u.statusText}`);const p=await u.json(),j=p.data?.data||[],f=Math.ceil(p.data?.total/10)||1;m(j),s(f)}catch(c){console.error("🚨 Error en fetchClientes:",c),h(c instanceof Error?c.message:"Ocurrió un error desconocido")}finally{o(!1)}})()},[r,d]),{clientes:n,totalPages:a,loading:l,error:x}},Q=()=>{const[r,d]=i.useState(!1),[n,m]=i.useState(1),{clientes:a,totalPages:s,loading:l,error:o}=G(r,n),[x,h]=i.useState(!1),[y,c]=i.useState(null),[b,u]=i.useState(!1),[p,j]=i.useState(null),[f,k]=i.useState(""),w=a.filter(t=>t.name.toLowerCase().includes(f.toLowerCase())||t.email.toLowerCase().includes(f.toLowerCase())||t.celular?.toLowerCase().includes(f.toLowerCase())||t.id.toString().includes(f)),v=()=>d(t=>!t),F=t=>{c(t),h(!0)},A=()=>{c(null),h(!0)},D=t=>{j(t),u(!0)},I=()=>{d(t=>!t),h(!1),g.fire({icon:"success",title:"Operación exitosa",text:"El cliente se ha guardado correctamente",confirmButtonColor:"#14b8a6"})};return l?e.jsx("div",{className:"flex justify-center items-center py-24 bg-white rounded-2xl shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-3 border-b-3 border-teal-500"}),e.jsx("p",{className:"text-teal-600 font-medium text-lg",children:"Cargando clientes..."})]})}):o?e.jsx("div",{className:"text-center py-16 bg-white rounded-2xl shadow-lg",children:e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl max-w-md mx-auto border border-red-100",children:[e.jsx("p",{className:"text-red-600 font-medium mb-4",children:"Error al cargar los clientes:"}),e.jsx("p",{className:"bg-white p-3 rounded-lg text-red-500 mb-6 border border-red-100",children:o}),e.jsxs("button",{onClick:v,className:"px-5 py-2 bg-teal-500 text-white rounded-full hover:bg-teal-600 flex items-center gap-2 mx-auto transition-all duration-300 shadow-md",children:[e.jsx(E,{})," Intentar nuevamente"]})]})}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-teal-600 px-8 py-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-extrabold flex items-center gap-3 text-white",children:[e.jsx(S,{}),e.jsx("span",{children:"Gestión de Clientes"})]}),e.jsx("p",{className:"text-teal-50 mt-2 text-lg",children:"Seguimiento y administración de clientes"})]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-2 bg-white text-teal-600 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold shadow-md hover:shadow-lg",children:[e.jsx(M,{})," Agregar Cliente"]})]})}),e.jsxs("div",{className:"p-8 space-y-6 border-b border-gray-100 bg-white",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-4 w-4 text-teal-500"}),e.jsx("input",{type:"text",placeholder:"Buscar clientes...",className:"pl-10 w-full rounded-full border-2 border-teal-100 py-3 px-5 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent shadow-sm transition-all duration-300",value:f,onChange:t=>k(t.target.value)})]}),e.jsxs("button",{onClick:v,disabled:l,className:"flex items-center gap-2 bg-white text-teal-600 border-2 border-teal-500 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold w-full sm:w-auto justify-center shadow-sm",children:[e.jsx(E,{className:`h-4 w-4 ${l?"animate-spin":""}`}),l?"Cargando...":"Actualizar"]})]}),e.jsx("div",{className:"flex items-center justify-between bg-teal-50 p-4 rounded-xl border border-teal-100 shadow-sm",children:e.jsxs("div",{className:"text-sm font-medium text-teal-700 flex items-center gap-2",children:[e.jsx("span",{className:"bg-teal-500 text-white text-sm font-bold py-1 px-3 rounded-full",children:w.length}),w.length===1?"cliente":"clientes"," encontrados"]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-teal-50 text-teal-800",children:e.jsx("tr",{children:["ID","NOMBRE","EMAIL","TELÉFONO","FECHA REGISTRO","ACCIÓN"].map((t,O)=>e.jsx("th",{className:"px-6 py-4 text-left font-bold tracking-wide uppercase text-xs whitespace-nowrap",children:t},O))})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-16 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(S,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:f?"No se encontraron clientes que coincidan con tu búsqueda":"No hay clientes registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:f?"Intenta con otros términos de búsqueda":"Comienza agregando clientes a tu sistema con el botón 'Agregar Cliente'"})]})})}):w.map(t=>e.jsxs("tr",{className:"hover:bg-teal-50/50 transition-colors duration-200",children:[e.jsxs("td",{className:"px-6 py-4 font-medium whitespace-nowrap text-teal-700",children:["#",t.id]}),e.jsx("td",{className:"px-6 py-4 font-medium",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-blue-600",children:t.email}),e.jsx("td",{className:"px-6 py-4",children:t.celular||e.jsx("span",{className:"text-gray-400 italic text-xs",children:"No disponible"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"bg-gray-100 py-1 px-3 rounded-full text-xs text-gray-700",children:t.created_at?new Date(t.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"Fecha no disponible"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-green-100 text-green-600 transition-colors duration-200 border border-transparent hover:border-green-200",title:"Editar",onClick:()=>F(t),children:e.jsx(P,{size:18})}),e.jsx("button",{className:"p-2 rounded-full text-red-500 border border-transparent transition-colors duration-200 hover:bg-red-100 hover:border-red-200",title:"Eliminar",onClick:()=>D(t.id),children:e.jsx(B,{size:18})})]})})]},t.id))})]})}),w.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 px-6 py-4 bg-gray-50 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(n-1)*5+1,"-",Math.min(n*5,w.length)," de ",w.length," clientes"]}),e.jsx(L,{currentPage:n,totalPages:s,onPageChange:t=>m(t)})]})]}),e.jsx(R,{isOpen:x,setIsOpen:h,cliente:y,onRefetch:I}),p!==null&&e.jsx(q,{isOpen:b,setIsOpen:u,clienteId:p,onRefetch:v})]})};export{Q as default};
