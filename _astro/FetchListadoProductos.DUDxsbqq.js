import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{c as D,g as M}from"./config.BZJ3FbET.js";import{R as E,r}from"./index.Be8AcK8B.js";import{c as S,d as k}from"./index.C7SCnFOA.js";import"./iconBase.Db4UJpFa.js";const y="productos_cache",R=300*1e3,I=()=>{try{const l=localStorage.getItem(y);if(!l)return null;const{data:s,timestamp:c}=JSON.parse(l);return Date.now()-c>R?(localStorage.removeItem(y),null):s}catch{return null}},B=l=>{try{const s={data:l,timestamp:Date.now()};localStorage.setItem(y,JSON.stringify(s))}catch{}},L=D.apiUrl;function W(){const[l,s]=r.useState([]),[c,n]=r.useState(!0),[u,m]=r.useState(null),[x,f]=r.useState(!1),p=r.useRef(null),[i,g]=r.useState(""),[d,b]=r.useState(null),[w,v]=r.useState(!0),N=r.useCallback(async(t=!0)=>{try{if(p.current?.abort(),n(!0),m(null),f(!0),t){const o=I();if(o){s(o),n(!1),f(!1);return}}p.current=new AbortController;const a=await fetch(M(D.endpoints.productos.list),{signal:p.current.signal});if(!a.ok)throw new Error("Error al obtener productos");const j=(await a.json()).map(o=>({id:o.id,nombre:o.nombre,link:o.link,titulo:o.titulo,subtitulo:o.subtitulo,lema:o.lema,descripcion:o.descripcion,especificaciones:o.especificaciones||{},productos_relacionados:o.productos_relacionados||[],imagenes:Array.isArray(o.imagenes)?o.imagenes.map(h=>({url_imagen:h.url_imagen||h.url||"",texto_alt_SEO:h.texto_alt_SEO||h.alt||"",imageTitle:h.imageTitle||""})):[],stock:o.stock,precio:parseFloat(o.precio),seccion:o.seccion,createdAt:o.created_at}));B(j),s(j)}catch(a){a.name!=="AbortError"&&(console.error("Error cargando productos:",a),m("Error al cargar los productos. Por favor, intenta nuevamente."))}finally{n(!1),f(!1)}},[]);r.useEffect(()=>(N(),()=>p.current?.abort()),[N]);const C=r.useCallback(t=>["Negocio","Decoración","Maquinaria"].map(_=>({productosDeLaSeccion:t.filter(j=>j.seccion===_)})),[]),F=r.useMemo(()=>{let t=[...l];return i.trim()&&(t=t.filter(a=>a.nombre.toLowerCase().includes(i.toLowerCase()))),d&&(t=t.filter(a=>a.seccion===d)),t},[l,i,d]),A=r.useMemo(()=>C(F),[F,C]);return c?e.jsx($,{}):u?e.jsxs("section",{className:"w-full flex flex-col items-center justify-center py-16",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:u}),e.jsx("button",{onClick:()=>N(!1),disabled:x,className:`px-6 py-2 rounded-lg transition-colors ${x?"bg-gray-400 cursor-not-allowed":"bg-teal-600 hover:bg-teal-700 text-white"}`,children:x?"Cargando...":"Reintentar"})]}):e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 p-8",children:[e.jsx("aside",{className:"md:w-4/12 xl:w-3/12 hidden sm:block",children:e.jsxs("div",{className:"p-4 border rounded-xl shadow-[0_0_10px_rgba(0,0,0,0.25)] shadow-[#00786F] space-y-4",children:[e.jsx("h1",{className:"uppercase underline text-teal-700 font-bold text-center text-3xl",children:"Filtros"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-teal-700 text-lg uppercase",children:"Nombre"}),e.jsx("input",{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:"Buscar...",className:"p-2 shadow-md rounded-md w-full outline-none focus:ring-2 focus:ring-teal-400"})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between items-center text-teal-700 hover:cursor-pointer",onClick:()=>v(t=>!t),children:[e.jsx("h2",{className:"font-bold text-lg uppercase",children:"Categorías"}),w?e.jsx(S,{}):e.jsx(k,{})]}),w&&e.jsx("div",{className:"flex flex-wrap gap-3 text-white font-semibold pt-3",children:[{name:"Negocio",color:"#00B6FF"},{name:"Decoración",color:"#5D39FB"},{name:"Maquinaria",color:"#04B088"}].map(({name:t,color:a})=>e.jsx("button",{onClick:()=>b(d===t?null:t),style:{backgroundColor:d===t?"#fff":a,color:d===t?a:""},className:"py-2 px-5 rounded-xl text-lg uppercase shadow-md hover:opacity-90 transition-all}",children:t},t))})]}),e.jsx("div",{className:"flex justify-center pt-10",children:e.jsx("button",{onClick:()=>{g(""),b(null)},className:"py-2 px-4 uppercase bg-white text-teal-700 border-2 border-teal-500 font-bold text-lg rounded-lg shadow-md hover:bg-teal-50 transition",children:"Limpiar filtros"})})]})}),e.jsx("div",{className:"block w-full m-auto sm:hidden relative",children:e.jsxs("div",{className:"p-4 flex items-center gap-4 border rounded shadow-[0_0_10px_rgba(0,0,0,0.25)] shadow-[#00786F] space-y-4 ",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-5 text-teal-700 hover:cursor-pointer mb-0",onClick:()=>v(t=>!t),children:[e.jsx("h1",{className:"uppercase underline text-teal-700 font-bold text-center text-xs mb-0",children:"Filtros"}),w?e.jsx(S,{size:12}):e.jsx(k,{size:12})]}),w&&e.jsxs("div",{className:"absolute left-0 top-20 flex flex-col gap-3 font-semibold px-8 py-2 bg-white border rounded-4xl z-10 shadow-[0_0_10px_rgba(0,0,0,0.25)] shadow-[#00786F] ",children:[e.jsx("h2",{className:"font-bold text-2xl uppercase text-[#00786F] text-center",children:"Categorías"}),[{name:"Negocio",color:"#00B6FF"},{name:"Decoración",color:"#5D39FB"},{name:"Maquinaria",color:"#04B088"}].map(({name:t,color:a})=>e.jsx("button",{onClick:()=>b(d===t?null:t),style:{backgroundColor:d===t?"#fff":a,color:d===t?a:""},className:"py-2 px-5 text-white rounded text-xl uppercase shadow-md hover:opacity-90 transition-all}",children:t},t)),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("button",{onClick:()=>{g(""),b(null)},className:"p-2 uppercase bg-white text-teal-700 border-2 border-teal-500 font-bold text-xs rounded shadow-md hover:bg-teal-50 transition",children:"Limpiar filtros"})})]}),e.jsx("input",{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:"Buscar...",className:"py-1.5 px-6 shadow-lg text-xs rounded-md w-full outline-none focus:ring-2 focus:ring-teal-400"})]})}),e.jsx("section",{className:`w-full xl:w-9/12 grid grid-rows-auto space-y-6 md:space-y-10 p-4
      rounded-md shadow-[0_0_7px_rgba(0,0,0,0.25)] shadow-[#00786F] sm:shadow-none sm:rounded-none m-auto`,children:A.map((t,a)=>t.productosDeLaSeccion.length>0&&e.jsx(z,{...t},`${a}`))})]})}function $(){return e.jsxs("section",{className:"flex justify-between gap-6 p-10",children:[e.jsx("div",{className:"bg-gray-300 animate-pulse h-56 w-3/12 rounded"}),e.jsx("div",{className:"w-9/12 grid grid-rows-auto",children:[1,2,3].map(l=>e.jsx("div",{className:"flex justify-center relative",children:e.jsx("div",{className:"relative w-full place-self-center",children:e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-3 gap-2 xs:gap-3 sm:gap-6 md:gap-8",children:[1,2,3,4,5,6,7,8].map(s=>e.jsxs("div",{className:"my-4 sm:my-6 md:my-10 flex flex-col items-center",children:[e.jsx("div",{className:"bg-gray-300 animate-pulse rounded-[15%] w-4/5 h-4/5 md:h-56 md:w-56 mb-3"}),e.jsx("div",{className:"bg-gray-300 animate-pulse h-4 w-3/4 rounded"})]},s))})})},l))})]})}const O=E.memo(function({productosDeLaSeccion:s}){const c=r.useMemo(()=>s.map(n=>e.jsx(q,{producto:n},n.id)),[s]);return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 xl:grid-cols-3 gap-6 ",children:c})}),z=O;function P(l={}){const[s,c]=r.useState(!1),n=r.useRef(null);return r.useEffect(()=>{const u=n.current;if(!u)return;const m=new IntersectionObserver(([x])=>{x.isIntersecting&&c(!0)},{threshold:.1,rootMargin:"100px",...l});return m.observe(u),()=>m.unobserve(u)},[l]),{targetRef:n,hasIntersected:s}}const U=E.memo(function({producto:s}){const[c,n]=r.useState(!1),{targetRef:u,hasIntersected:m}=P(),x=r.useMemo(()=>{const i=s.imagenes?.[0]?.url_imagen;return i?i.startsWith("http")?i:`${L.replace(/\/$/,"")}${i}`:`https://placehold.co/300x300/e5e7eb/6b7280?text=${encodeURIComponent(s.nombre)}`},[s.imagenes,s.nombre]),f={Negocio:"from-[#00B6FF]/50 to-white text-[#0374A2]",Decoración:"from-[#5D39FB]/50 to-white text-[#5D39FB]",Maquinaria:"from-[#00786F]/50 to-white text-[#00786F]",Default:"from-[#0374A2]/50 to-white text-[#0374A2]"},p=f[s.seccion]||f.Default;return e.jsx("a",{href:`/productos/${s.link}`,title:`Ver detalles de ${s.nombre}`,className:"flex flex-col items-center group hover:cursor-pointer w-full relative h-[150px] md:h-[360px]",children:e.jsxs("div",{ref:u,className:"h-full w-full relative",children:[!c&&e.jsx("div",{className:"absolute inset-0 bg-gray-300 animate-pulse flex items-center justify-center rounded-xl"}),m&&e.jsx("img",{src:x,alt:s.nombre,loading:"lazy",onLoad:()=>n(!0),className:`rounded-xl object-contain w-full h-[150px] md:h-[360px] transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`,style:{aspectRatio:"1"}}),e.jsx("div",{className:`absolute bottom-0 w-full flex justify-center bg-gradient-to-b ${p} shadow-lg rounded-xl backdrop-blur-xs`,children:e.jsxs("div",{className:"flex justify-between items-center gap-2 w-full p-3 min-h-[40px] md:min-h-[100px]",children:[e.jsx("h3",{className:"text-xs md:text-base font-bold uppercase",children:s.nombre}),e.jsx("button",{className:"bg-white py-1 px-3 rounded-md font-semibold text-xs sm:text-sm shadow hover:bg-gray-100",children:"Comprar"})]})})]})})}),q=U;export{W as default};
