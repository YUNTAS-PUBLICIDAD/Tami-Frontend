import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.DtoOFyvK.js";import{g as O,a as L,f as P,c as R,d as q}from"./index.BK6zlZpu.js";import{g as k,c as A}from"./config.BBxWIZNq.js";import{S as h}from"./sweetalert2.esm.all.Bj_ZQUAw.js";import{L as G,S as J,T as U,a as _,b as T,c as H,d as V,e as C,P as K}from"./Table.BAEQNYdp.js";import{E as Q}from"./ErrorComponent.BP9FaxPf.js";import"./iconBase.BJk3kZaN.js";const D=()=>{const l=()=>{const s=localStorage.getItem("token");if(!s)throw new Error("No se encontró el token");return s};return{addCliente:async s=>{const r=l(),i=k(A.endpoints.clientes.create),a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(s)});if(!a.ok){let f=null;try{f=await a.json()}catch{}throw f?new Error(JSON.stringify(f)):new Error("Error al agregar cliente")}return(await a.json()).data},updateCliente:async(s,r)=>{const i=l(),a=k(A.endpoints.clientes.update(s)),n=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)});if(!n.ok)throw new Error("Error al actualizar cliente");return(await n.json()).data},deleteCliente:async s=>{const r=l(),i=k(A.endpoints.clientes.delete(s)),a=await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Error al eliminar cliente");return await a.json()}}},W=(l,x)=>{const[o,m]=c.useState({name:"",celular:"",email:""}),[s,r]=c.useState({}),[i,a]=c.useState(!1),{addCliente:n,updateCliente:f}=D();c.useEffect(()=>{l?(m({name:l.name,celular:l.celular,email:l.email}),a(!0),r({})):b()},[l]);const j=w=>{m({...o,[w.target.name]:w.target.value}),r({...s,[w.target.name]:""})},y=async w=>{w.preventDefault(),r({});const{name:N,celular:u,email:E}=o;if(!N.trim()||!u.trim()||!E.trim()){await h.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."});return}if(!/^\d+$/.test(u)){await h.fire({icon:"warning",title:"Teléfono inválido",text:"⚠️ El teléfono solo debe contener números."});return}try{i?(await f(l.id,{name:N,celular:u,email:E}),await h.fire({icon:"success",title:"Cliente actualizado",text:"✅ Cliente actualizado correctamente"})):(await n({name:N,celular:u,email:E}),await h.fire({icon:"success",title:"Cliente registrado",text:"✅ Cliente registrado exitosamente"})),x?.(),b()}catch(g){console.error("❌ Error en la operación:",g);let p={};try{const d=JSON.parse(g.message);if(d.errors)d.errors.name&&(p.name=d.errors.name.join(" ")),d.errors.celular&&(p.celular=d.errors.celular.join(" ")),d.errors.email&&(p.email=d.errors.email.join(" "));else if(d.message){await h.fire({icon:"error",title:"Error",text:`❌ ${d.message}`});return}else{await h.fire({icon:"error",title:"Error",text:"❌ Error desconocido."});return}}catch{await h.fire({icon:"error",title:"Error",text:`❌ ${g.message||"Error desconocido"}`});return}r({name:p.name||"",celular:p.celular||"",email:p.email||""})}},b=()=>{m({name:"",celular:"",email:""}),r({}),a(!1)};return{formData:o,errors:s,handleChange:j,handleSubmit:y,resetForm:b}},X=({isOpen:l,setIsOpen:x,cliente:o,onRefetch:m})=>{const{formData:s,handleChange:r,handleSubmit:i,errors:a,resetForm:n}=W(o,()=>{m(),x(!1)});return l?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl px-6 sm:px-8 py-8 sm:py-10 animate-scaleIn",children:[e.jsx("h2",{className:"text-2xl font-bold text-teal-600 mb-6 text-center",children:o?"Editar Cliente":"Añadir Cliente"}),e.jsxs("form",{onSubmit:i,className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",className:"text-sm font-medium text-teal-700 mb-1",children:"Nombres"}),e.jsx("input",{id:"name",name:"name",type:"text",value:s.name,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${a.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. Juan Pérez"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:a.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"celular",className:"text-sm font-medium text-teal-700 mb-1",children:"Teléfono"}),e.jsx("input",{id:"celular",name:"celular",type:"text",value:s.celular,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${a.celular?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. 987654321"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:a.celular||" "})]}),e.jsxs("div",{className:"flex flex-col sm:col-span-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-teal-700 mb-1",children:"Gmail"}),e.jsx("input",{id:"email",name:"email",type:"email",value:s.email,onChange:r,required:!0,className:`p-3 rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder:text-gray-400 ${a.email?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Ej. cliente@gmail.com"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 min-h-[1.25rem]",children:a.email||" "})]}),e.jsxs("div",{className:"sm:col-span-2 flex flex-col sm:flex-row justify-end items-center gap-3 mt-4",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto bg-teal-600 text-white px-5 py-2 rounded-lg hover:bg-teal-700 transition shadow",children:o?"Guardar Cambios":"Añadir Cliente"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),n()},className:"w-full sm:w-auto bg-gray-100 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-200 transition",children:"Cancelar"})]})]})]})}):null},Y=({isOpen:l,setIsOpen:x,clienteId:o,onRefetch:m})=>{const{deleteCliente:s}=D(),r=async()=>{if((await h.fire({title:"¿Eliminar cliente?",text:"Esta acción es permanente y no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await s(o),h.fire("Eliminado","El cliente ha sido eliminado exitosamente.","success"),m()}catch(a){console.error("Error al eliminar cliente:",a),h.fire("Error","No se pudo eliminar el cliente.","error")}x(!1)};return l&&r(),null},Z=l=>{const[x,o]=c.useState([]),[m,s]=c.useState(!0),[r,i]=c.useState(null);return c.useEffect(()=>{(async()=>{s(!0),i(null);try{const n=localStorage.getItem("token");if(!n)throw new Error("No se encontró el token de autenticación");const f=`${k(A.endpoints.clientes.list)}`,j=await fetch(f,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!j.ok)throw new Error(`Error al obtener clientes: ${j.statusText}`);const y=await j.json(),b=Array.isArray(y.data)?y.data:y.data?.data||[];o(b)}catch(n){console.error("Error en fetchClientes:",n),i(n instanceof Error?n.message:"Ocurrió un error desconocido")}finally{s(!1)}})()},[l]),{clientes:x,loading:m,error:r}},ie=()=>{const[l,x]=c.useState(!1),[o,m]=c.useState(1),{clientes:s,loading:r,error:i}=Z(l),[a,n]=c.useState(!1),[f,j]=c.useState(null),[y,b]=c.useState(!1),[w,N]=c.useState(null),[u,E]=c.useState("");c.useEffect(()=>{m(1)},[u]);const g=5,p=s.filter(t=>t.name.toLowerCase().includes(u.toLowerCase())||t.email.toLowerCase().includes(u.toLowerCase())||t.celular?.toLowerCase().includes(u.toLowerCase())||t.id.toString().includes(u)),d=p.length,I=Math.ceil(d/g),S=p.slice((o-1)*g,o*g),F=()=>x(t=>!t),M=t=>{j(t),n(!0)},$=()=>{j(null),n(!0)},z=t=>{N(t),b(!0)},B=t=>{x(v=>!v),n(!1),h.fire({icon:"success",title:"Operación exitosa",text:t||"El cliente se ha guardado correctamente",confirmButtonColor:"#14b8a6"})};return r?e.jsx(G,{message:"Cargando clientes..."}):i?e.jsx(Q,{handleRefetch:F,error:i}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-teal-600 px-8 py-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-extrabold flex items-center gap-3 text-white",children:[e.jsx(O,{}),e.jsx("span",{children:"Gestión de Clientes"})]}),e.jsx("p",{className:"text-teal-50 mt-2 text-lg",children:"Seguimiento y administración de clientes"})]}),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 bg-white text-teal-600 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold shadow-md hover:shadow-lg",children:[e.jsx(L,{})," Agregar Cliente"]})]})}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center",children:[e.jsx(J,{placeholder:"Buscar clientes...",value:u,onChange:E}),e.jsxs("button",{onClick:F,disabled:r,className:"flex items-center gap-2 bg-white text-teal-600 border-2 border-teal-500 hover:bg-teal-50 transition-all duration-300 px-5 py-3 rounded-full text-sm font-bold w-full sm:w-auto justify-center shadow-sm",children:[e.jsx(P,{className:`h-4 w-4 ${r?"animate-spin":""}`}),r?"Cargando...":"Actualizar"]})]}),e.jsx("div",{className:"flex items-center justify-between bg-teal-50 p-4 rounded-xl border border-teal-100 shadow-sm",children:e.jsxs("div",{className:"text-sm font-medium text-teal-700 flex items-center gap-2",children:[e.jsx("span",{className:"bg-teal-500 text-white text-sm font-bold py-1 px-3 rounded-full",children:d}),d===1?"cliente":"clientes"," encontrados"]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(U,{children:[e.jsx(_,{children:e.jsx(T,{children:["ID","NOMBRE","EMAIL","TELÉFONO","ACCIÓN"].map((t,v)=>e.jsx(H,{className:"text-xs whitespace-nowrap",children:t},v))})}),e.jsx(V,{children:S.length===0?e.jsx(T,{children:e.jsx(C,{colSpan:7,children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(O,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:u?"No se encontraron clientes que coincidan con tu búsqueda":"No hay clientes registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:u?"Intenta con otros términos de búsqueda":"Comienza agregando clientes a tu sistema con el botón 'Agregar Cliente'"})]})})}):e.jsxs(e.Fragment,{children:[S.map(t=>e.jsxs(T,{children:[e.jsxs(C,{className:"px-6 py-4 font-medium whitespace-nowrap text-teal-700",children:["#",t.id]}),e.jsx(C,{children:t.name}),e.jsx(C,{className:"text-blue-500",children:t.email}),e.jsx(C,{children:t.celular||e.jsx("span",{className:"text-gray-400 italic text-xs",children:"No disponible"})}),e.jsx(C,{children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-green-100 text-green-600 transition-colors duration-200 border border-transparent hover:border-green-200",title:"Editar",onClick:()=>M(t),children:e.jsx(R,{size:18})}),e.jsx("button",{className:"p-2 rounded-full text-red-500 border border-transparent transition-colors duration-200 hover:bg-red-100 hover:border-red-200",title:"Eliminar",onClick:()=>z(t.id),children:e.jsx(q,{size:18})})]})})]},t.id)),Array.from({length:g-S.length}).map((t,v)=>e.jsxs(T,{className:"h-17",children:[" ",e.jsx(C,{colSpan:5,className:"px-6 py-4",children:" "})]},`empty-${v}`))]})})]})}),S.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 px-6 py-4 bg-gray-50 dark:bg-gray-600/20",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(o-1)*g+1," -"," ",Math.min(o*g,d)," de ",d," clientes"]}),e.jsx(K,{currentPage:o,totalPages:I,onPageChange:t=>m(t)})]})]}),e.jsx(X,{isOpen:a,setIsOpen:n,cliente:f,onRefetch:B}),w!==null&&e.jsx(Y,{isOpen:y,setIsOpen:b,clienteId:w,onRefetch:F})]})};export{ie as default};
