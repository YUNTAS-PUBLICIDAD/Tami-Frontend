import{c as i}from"./config.DrCsXt2T.js";const m={NEGOCIOS:{gradient:"custom-gradient-negocio",title:"Descubre tu guía exclusiva de decoración TOTALMENTE GRATIS",btn:"btn-gradient-negocio-fix border border-white cursor-pointer",buttonText:"¡COTIZA AHORA!"},MAQUINARIA:{gradient:"custom-gradient-maquinaria",title:"Descubre tu guía exclusiva de decoración TOTALMENTE GRATIS",btn:"btn-gradient-negocio-fix border border-white cursor-pointer",buttonText:"¡COTIZA AHORA!"},DECORACIÓN:{gradient:"custom-gradient-decoracion",title:"Descubre tu guía exclusiva de decoración TOTALMENTE GRATIS",btn:"btn-gradient-negocio-fix border border-white cursor-pointer",buttonText:"¡COTIZA AHORA!"}},I="/images/popup/default.webp",u=document.getElementById("modal-form-container");u?.dataset.whatsapp;let d=m.NEGOCIOS;const A="asesoriaModalLastClosedDetalle",y=180*1e3;let g=!1,E=!1;async function p(){O(),await f();const e=document.getElementById("modal-cotizacion-producto"),t=document.getElementById("modal-cotizacion-mensaje"),o=document.querySelector(".img-white-zone");e&&t&&(e.classList.remove("hidden"),t.textContent="",g=!0),o&&o.classList.add("img-negocios-bg")}async function f(){const e=document.getElementById("modal-form-container"),t=document.getElementById("modal-product-img");if(!e||!t)return;const o=e.dataset.productLink||"";let c=I,r="Imagen del producto";if(!window.__detalleProducto&&o)try{const a=await fetch(`${i.apiUrl}/api/v1/productos/link/${o}`);if(a.ok){const n=await a.json();window.__detalleProducto=n.data||n}}catch{}if(window.__detalleProducto){const a=window.__detalleProducto,n=a.producto_imagenes?.find(s=>s.tipo==="popup");n?.url_imagen?(c=`${i.apiUrl}${n.url_imagen}`,r=n.texto_alt_SEO||a.nombre||"Imagen del producto"):a.imagenes&&a.imagenes.length>0&&(c=`${i.apiUrl}${a.imagenes[0].url_imagen}`,r=a.imagenes[0].texto_alt_SEO||a.nombre||"Imagen del producto")}t.src=c,t.alt=r,t.onerror=function(){t.src=I,t.alt="Imagen por defecto"}}function C(){const e=parseInt(localStorage.getItem(A)||"0",10);return Date.now()-e>=y}const b=document.getElementById("close-modal-cotizacion");b&&(b.onclick=()=>{const e=document.getElementById("modal-cotizacion-producto");e&&e.classList.add("hidden"),localStorage.setItem(A,Date.now().toString()),g=!1});const l=document.getElementById("form-cotizacion-producto");l&&(l.onsubmit=async e=>{e.preventDefault();const t=new FormData(l),o=t.get("nombre"),c="+51 "+t.get("telefono"),r=t.get("correo"),a=document.getElementById("modal-form-container")?.dataset.productLink,n=document.getElementById("modal-cotizacion-mensaje");try{console.log("API URL:",i.apiUrl),console.log("ENDPOINT:",i.endpoints?.whatsapp?.info),console.log("URL FINAL:",`${i.apiUrl}${i.endpoints?.whatsapp?.info}`),await fetch(`${i.apiUrl}${i.endpoints.whatsapp.info}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:a,phone:c,email:r??null})}),n&&(n.textContent="Enviado a WhatsApp ✅")}catch(s){console.error("ERROR WHATSAPP:",s)}try{(await fetch(`${i.apiUrl}${i.endpoints.email.sendEmailByProductLink}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,celular:c,email:r,link:a})})).ok?n&&(n.textContent="Correo enviado con éxito ✅"):n&&(n.textContent="Error al enviar el correo. Intenta nuevamente.")}catch{n&&(n.textContent="Error al enviar el correo. Intenta nuevamente.")}l.reset()});function O(){const e=document.getElementById("background-modal");document.getElementById("modal-form-container");const t=document.getElementById("modal-title"),o=document.getElementById("modal-submit-btn");e&&(e.classList.remove("custom-gradient-negocio","custom-gradient-maquinaria","custom-gradient-decoracion"),e.classList.add(d.gradient)),t&&(t.innerHTML=d.title.replace("GRATIS","<span class='font-extrabold'>GRATIS</span>"));const c=document.getElementById("modal-negocios-text");if(c&&c.classList.remove("hidden"),o){o.className="mt-4 py-2 rounded-lg text-white transition-all duration-300 shadow-lg font-bold";const r=d.btn.split(" ");o.classList.add(...r),o.textContent=d.buttonText||"¡COTIZA AHORA!"}}function T(){document.querySelectorAll('[id^="btnQuotation"]').forEach(t=>{t.addEventListener("click",async()=>{await p()})})}window.addEventListener("open-scroll-modal",async()=>{await p()});window.addEventListener("scroll",async()=>{window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100>30&&!E&&C()&&!g&&(E=!0,await p())});function w(){const e=document.getElementById("modal-form-container");if(!e)return;const o=(e.dataset.seccion||"NEGOCIOS").normalize?.("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase(),r={NEGOCIOS:"NEGOCIOS",MAQUINARIA:"MAQUINARIA",DECORACION:"DECORACIÓN"}[o]||"NEGOCIOS";d=m[r]||m.NEGOCIOS,O()}u&&new MutationObserver(t=>{t.forEach(async o=>{o.attributeName==="data-seccion"&&w(),o.attributeName==="data-product-link"&&await f()})}).observe(u,{attributes:!0,attributeFilter:["data-seccion","data-product-link"]});document.addEventListener("DOMContentLoaded",async function(){localStorage.removeItem("asesoriaModalLastClosedDetalle"),w(),await f(),T()});
